{"version":3,"file":"index-DJHGC_bB.js","sources":["../../js/search-engine.js","../../js/scoring.js","../../js/ui-components.js","../../js/lazy-loading.js","../../js/app.js","../../api/claude-integration.js"],"sourcesContent":["export class ApartmentSearchEngine {\n    constructor() {\n        this.searchCriteria = {\n            minRent: 4400,\n            maxRent: 5200,\n            bedrooms: 2,\n            minBathrooms: 1.5,\n            maxBathrooms: 2.0,\n            zipCodes: ['90066', '90230', '90232', '90034'],\n            zipCodePriority: {\n                '90066': 1, // Mar Vista - highest priority\n                '90230': 2, // Central Culver City\n                '90232': 3, // Southeast Culver City\n                '90034': 4  // Palms\n            },\n            requiredAmenities: [\n                'washer_dryer',\n                'air_conditioning',\n                'outdoor_space',\n                'above_ground_floor'\n            ],\n            preferredFeatures: [\n                'recently_renovated',\n                'modern_interior',\n                'natural_light'\n            ]\n        };\n        \n        this.dataSources = [\n            { name: 'apartments.com', priority: 1, active: true },\n            { name: 'westside_rentals', priority: 1, active: true },\n            { name: 'zillow', priority: 1, active: true },\n            { name: 'trulia', priority: 2, active: true },\n            { name: 'hotpads', priority: 2, active: true },\n            { name: 'redfin', priority: 2, active: true },\n            { name: 'rentcafe', priority: 2, active: true },\n            { name: 'zumper', priority: 2, active: true },\n            { name: 'realtor.com', priority: 2, active: true },\n            { name: 'craigslist', priority: 3, active: true }\n        ];\n        \n        // Scoring will be handled by external module\n    }\n\n    async searchApartments(progressCallback) {\n        const allApartments = [];\n        const currentProgress = 0;\n        const totalSteps = this.searchCriteria.zipCodes.length + 1; // +1 for final scoring\n        \n        // Search each zip code\n        for (let i = 0; i < this.searchCriteria.zipCodes.length; i++) {\n            const zipCode = this.searchCriteria.zipCodes[i];\n            \n            if (progressCallback) {\n                progressCallback((i / totalSteps) * 100);\n            }\n            \n            try {\n                const apartments = await this.searchZipCode(zipCode);\n                allApartments.push(...apartments);\n                \n                // Add small delay to prevent overwhelming APIs\n                await this.delay(500);\n            } catch (error) {\n                console.error(`Error searching zip code ${zipCode}:`, error);\n            }\n        }\n        \n        // Final scoring and ranking\n        if (progressCallback) {\n            progressCallback(((totalSteps - 1) / totalSteps) * 100);\n        }\n        \n        // Return apartments without scoring (will be handled by caller)\n        const validApartments = allApartments.filter(apt => this.validateApartment(apt));\n        \n        if (progressCallback) {\n            progressCallback(100);\n        }\n        \n        return this.removeDuplicates(validApartments);\n    }\n\n    async searchZipCode(zipCode) {\n        console.log(`Searching zip code: ${zipCode}`);\n        \n        // Since we can't actually call external APIs in this demo,\n        // we'll generate realistic mock data based on the zip code\n        return this.generateMockApartments(zipCode);\n    }\n\n    generateMockApartments(zipCode) {\n        const apartmentCount = Math.floor(Math.random() * 15) + 5; // 5-20 apartments per zip\n        const apartments = [];\n        \n        // Zip code specific data\n        const zipCodeData = {\n            '90066': { // Mar Vista\n                areaName: 'Mar Vista',\n                basePrice: 4800,\n                priceVariance: 300,\n                neighborhoods: ['Mar Vista', 'Venice Adjacent', 'Westside']\n            },\n            '90230': { // Central Culver City\n                areaName: 'Culver City',\n                basePrice: 4600,\n                priceVariance: 400,\n                neighborhoods: ['Downtown Culver City', 'Arts District', 'Hayden Tract']\n            },\n            '90232': { // Southeast Culver City\n                areaName: 'Culver City',\n                basePrice: 4500,\n                priceVariance: 350,\n                neighborhoods: ['Fox Hills', 'Culver West', 'Baldwin Hills Adjacent']\n            },\n            '90034': { // Palms\n                areaName: 'Palms',\n                basePrice: 4400,\n                priceVariance: 300,\n                neighborhoods: ['Palms', 'Motor Avenue', 'Mid City West']\n            }\n        };\n        \n        const areaData = zipCodeData[zipCode];\n        const streetNames = [\n            'Pacific Ave', 'Lincoln Blvd', 'Venice Blvd', 'Washington Blvd',\n            'Motor Ave', 'Sepulveda Blvd', 'Culver Blvd', 'Jefferson Blvd',\n            'Pico Blvd', 'Olympic Blvd', 'Exposition Blvd', 'National Blvd'\n        ];\n        \n        const buildingTypes = [\n            'Modern Apartment Complex', 'Luxury Townhome', 'Contemporary Loft',\n            'Garden Style Apartment', 'Mid-Rise Building', 'Renovated Complex'\n        ];\n        \n        const amenityPool = [\n            'In-Unit Washer/Dryer', 'Central Air Conditioning', 'Private Balcony',\n            'Stainless Steel Appliances', 'Hardwood Floors', 'Walk-in Closet',\n            'Granite Countertops', 'Swimming Pool', 'Fitness Center', 'Parking Garage',\n            'Pet Friendly', 'Dishwasher', 'Recently Renovated', 'Natural Light',\n            'High Ceilings', 'Modern Kitchen', 'Patio/Deck', 'Storage Unit'\n        ];\n        \n        for (let i = 0; i < apartmentCount; i++) {\n            const buildingNumber = Math.floor(Math.random() * 9999) + 1000;\n            const streetName = streetNames[Math.floor(Math.random() * streetNames.length)];\n            const buildingType = buildingTypes[Math.floor(Math.random() * buildingTypes.length)];\n            \n            // Price calculation with some variance\n            const basePrice = areaData.basePrice;\n            const priceOffset = (Math.random() - 0.5) * areaData.priceVariance * 2;\n            const price = Math.round((basePrice + priceOffset) / 50) * 50; // Round to nearest $50\n            \n            // Ensure price is within budget\n            const finalPrice = Math.max(4400, Math.min(5200, price));\n            \n            // Random but realistic features\n            const selectedAmenities = this.selectRandomAmenities(amenityPool, 8, 12);\n            const floor = Math.floor(Math.random() * 8) + 2; // Floors 2-9 (above ground)\n            const sqft = 900 + Math.floor(Math.random() * 400); // 900-1300 sq ft\n            const bathrooms = Math.random() > 0.4 ? 2.0 : 1.5; // 60% chance of 2 bath, 40% chance of 1.5\n            \n            // Recent renovation chance (higher for more expensive units)\n            const renovationChance = (finalPrice - 4400) / 800; // 0-1 based on price\n            const recentlyRenovated = Math.random() < (0.3 + renovationChance * 0.4);\n            \n            // Recent posting (some apartments are newer listings)\n            const daysAgo = Math.floor(Math.random() * 30); // 0-30 days ago\n            const datePosted = new Date(Date.now() - daysAgo * 24 * 60 * 60 * 1000);\n            \n            const apartment = {\n                id: `apt_${zipCode}_${i}_${Date.now()}`,\n                title: `${buildingType} in ${areaData.areaName}`,\n                address: `${buildingNumber} ${streetName}, ${areaData.areaName}, CA ${zipCode}`,\n                zipCode,\n                price: finalPrice,\n                bedrooms: 2,\n                bathrooms,\n                sqft,\n                floor,\n                features: selectedAmenities,\n                highlightFeatures: this.getHighlightFeatures(selectedAmenities),\n                recentlyRenovated,\n                premiumAmenities: selectedAmenities.includes('Swimming Pool') || \n                                selectedAmenities.includes('Fitness Center') ||\n                                selectedAmenities.includes('Parking Garage'),\n                datePosted: datePosted.toISOString(),\n                source: this.getRandomSource(),\n                url: this.generateListingUrl(buildingType, areaData.areaName, zipCode, finalPrice),\n                contact: {\n                    phone: this.generatePhoneNumber(),\n                    email: `leasing@${buildingType.toLowerCase().replace(/\\s+/g, '')}apartments.com`\n                },\n                images: this.generateMockImages(),\n                description: this.generateDescription(buildingType, areaData.areaName, selectedAmenities),\n                score: 0 // Will be calculated later\n            };\n            \n            apartments.push(apartment);\n        }\n        \n        return apartments;\n    }\n\n    selectRandomAmenities(pool, min, max) {\n        const count = Math.floor(Math.random() * (max - min + 1)) + min;\n        const shuffled = [...pool].sort(() => 0.5 - Math.random());\n        return shuffled.slice(0, count);\n    }\n\n    getHighlightFeatures(features) {\n        const highlights = [];\n        const highlightMap = {\n            'In-Unit Washer/Dryer': 'In-Unit Washer/Dryer',\n            'Central Air Conditioning': 'Central Air Conditioning',\n            'Private Balcony': 'Private Balcony',\n            'Recently Renovated': 'Recently Renovated',\n            'Natural Light': 'Natural Light',\n            'Modern Kitchen': 'Modern Kitchen'\n        };\n        \n        features.forEach(feature => {\n            if (highlightMap[feature]) {\n                highlights.push(feature);\n            }\n        });\n        \n        return highlights;\n    }\n\n    getRandomSource() {\n        const sources = [\n            'Apartments.com', 'Westside Rentals', 'Zillow Rentals',\n            'Trulia', 'HotPads', 'Redfin', 'RentCafe', 'Zumper'\n        ];\n        return sources[Math.floor(Math.random() * sources.length)];\n    }\n\n    generatePhoneNumber() {\n        const areaCode = ['310', '424', '323'][Math.floor(Math.random() * 3)];\n        const exchange = Math.floor(Math.random() * 900) + 100;\n        const number = Math.floor(Math.random() * 9000) + 1000;\n        return `(${areaCode}) ${exchange}-${number}`;\n    }\n\n    generateListingUrl(buildingType, areaName, zipCode, price) {\n        const sources = [\n            {\n                name: 'Apartments.com',\n                baseUrl: 'https://www.apartments.com',\n                template: (_building, area, zip, price) => {\n                    const minPrice = Math.floor(price * 0.9);\n                    const maxPrice = Math.floor(price * 1.1);\n                    const cityState = `${area.replace(/\\s+/g, '-')}-ca`;\n                    return `${cityState}/${zip}/?bb=${minPrice}-${maxPrice}&t=apartments`;\n                }\n            },\n            {\n                name: 'Zillow',\n                baseUrl: 'https://www.zillow.com',\n                template: (_building, area, zip, price) => {\n                    const minPrice = Math.floor(price * 0.9);\n                    const maxPrice = Math.floor(price * 1.1);\n                    return `homes/for_rent/${zip}_rb/?searchQueryState=%7B%22pagination%22%3A%7B%7D%2C%22usersSearchTerm%22%3A%22${zip}%22%2C%22mapBounds%22%3A%7B%7D%2C%22regionSelection%22%3A%5B%7B%22regionId%22%3A${zip}%2C%22regionType%22%3A7%7D%5D%2C%22isMapVisible%22%3Atrue%2C%22filterState%22%3A%7B%22price%22%3A%7B%22min%22%3A${minPrice}%2C%22max%22%3A${maxPrice}%7D%2C%22beds%22%3A%7B%22min%22%3A2%7D%2C%22baths%22%3A%7B%22min%22%3A1%7D%7D%2C%22isListVisible%22%3Atrue%7D`;\n                }\n            },\n            {\n                name: 'Trulia',\n                baseUrl: 'https://www.trulia.com',\n                template: (_building, area, zip, price) => {\n                    const minPrice = Math.floor(price * 0.9);\n                    const maxPrice = Math.floor(price * 1.1);\n                    const citySlug = area.toLowerCase().replace(/\\s+/g, '_');\n                    return `for_rent/${citySlug},ca/${zip}_p/2p_beds/${minPrice}-${maxPrice}_price/`;\n                }\n            },\n            {\n                name: 'HotPads',\n                baseUrl: 'https://hotpads.com',\n                template: (_building, area, zip, price) => {\n                    const minPrice = Math.floor(price * 0.9);\n                    const maxPrice = Math.floor(price * 1.1);\n                    const citySlug = area.toLowerCase().replace(/\\s+/g, '-');\n                    return `${citySlug}-ca-${zip}/apartments-for-rent?price=${minPrice}-${maxPrice}&beds=2`;\n                }\n            },\n            {\n                name: 'Westside Rentals',\n                baseUrl: 'https://www.westsiderentals.com',\n                template: (_building, area, zip, price) => {\n                    const minPrice = Math.floor(price * 0.9);\n                    const maxPrice = Math.floor(price * 1.1);\n                    return `listingsearch?search_form%5Bcity%5D=${encodeURIComponent(area)}&search_form%5Bzipcode%5D=${zip}&search_form%5Bmin_rent%5D=${minPrice}&search_form%5Bmax_rent%5D=${maxPrice}&search_form%5Bbedrooms%5D=2`;\n                }\n            },\n            {\n                name: 'Realtor.com',\n                baseUrl: 'https://www.realtor.com',\n                template: (_building, area, zip, price) => {\n                    const minPrice = Math.floor(price * 0.9);\n                    const maxPrice = Math.floor(price * 1.1);\n                    const citySlug = area.toLowerCase().replace(/\\s+/g, '-');\n                    return `apartments-for-rent/${citySlug}-ca-${zip}?price-min=${minPrice}&price-max=${maxPrice}&beds-min=2`;\n                }\n            }\n        ];\n\n        const randomSource = sources[Math.floor(Math.random() * sources.length)];\n        const urlPath = randomSource.template(buildingType, areaName, zipCode, price);\n        \n        return `${randomSource.baseUrl}/${urlPath}`;\n    }\n\n    generateMockImages() {\n        // In a real app, these would be actual image URLs\n        const imageCount = Math.floor(Math.random() * 5) + 1; // 1-5 images\n        const images = [];\n        \n        for (let i = 0; i < imageCount; i++) {\n            images.push(`https://via.placeholder.com/600x400/f0f0f0/666666?text=Apartment+Image+${i + 1}`);\n        }\n        \n        return images;\n    }\n\n    generateDescription(buildingType, area, amenities) {\n        const descriptions = [\n            `Beautiful ${buildingType.toLowerCase()} located in the heart of ${area}. This stunning 2-bedroom unit features modern finishes and premium amenities.`,\n            `Discover luxury living in this ${buildingType.toLowerCase()} in ${area}. Perfectly designed for comfort and style.`,\n            `Spacious and bright 2-bedroom apartment in a desirable ${area} location. This ${buildingType.toLowerCase()} offers the perfect blend of comfort and convenience.`\n        ];\n        \n        const baseDescription = descriptions[Math.floor(Math.random() * descriptions.length)];\n        const amenityText = amenities.slice(0, 4).join(', ');\n        \n        return `${baseDescription} Key features include: ${amenityText}. Contact us today to schedule a viewing!`;\n    }\n\n    // Removed scoreAndRankApartments - handled by external scoring module\n\n    removeDuplicates(apartments) {\n        const seen = new Set();\n        return apartments.filter(apartment => {\n            const key = `${apartment.address}_${apartment.price}_${apartment.bedrooms}`;\n            if (seen.has(key)) {\n                return false;\n            }\n            seen.add(key);\n            return true;\n        });\n    }\n\n    delay(ms) {\n        return new Promise(resolve => setTimeout(resolve, ms));\n    }\n\n    // Method to validate apartment against mandatory criteria\n    validateApartment(apartment) {\n        const criteria = this.searchCriteria;\n        \n        // Check price range\n        if (apartment.price < criteria.minRent || apartment.price > criteria.maxRent) {\n            return false;\n        }\n        \n        // Check bedrooms\n        if (apartment.bedrooms !== criteria.bedrooms) {\n            return false;\n        }\n        \n        // Check bathrooms\n        if (apartment.bathrooms < criteria.minBathrooms || apartment.bathrooms > criteria.maxBathrooms) {\n            return false;\n        }\n        \n        // Check required amenities (simplified check)\n        const features = apartment.features.map(f => f.toLowerCase());\n        const hasWasherDryer = features.some(f => f.includes('washer') && f.includes('dryer'));\n        const hasAC = features.some(f => f.includes('air') || f.includes('conditioning'));\n        const hasOutdoor = features.some(f => f.includes('balcony') || f.includes('patio') || f.includes('deck'));\n        const aboveGround = apartment.floor > 1;\n        \n        if (!hasWasherDryer || !hasAC || !hasOutdoor || !aboveGround) {\n            return false;\n        }\n        \n        return true;\n    }\n}","export class ApartmentScoring {\n    constructor() {\n        this.weights = {\n            // Base criteria (50 points total)\n            rentInRange: 20,        // Within $4,400-$5,200 range\n            mandatoryAmenities: 30, // All required amenities present\n            \n            // Quality factors (35 points total)\n            renovationRecency: 25,  // Recently renovated (within 10 years)\n            naturalLight: 15,       // Natural light indicators\n            outdoorSpaceQuality: 10, // Quality of balcony/patio/terrace\n            \n            // Location factors (10 points total)\n            zipCodePriority: 10,    // Preferred zip code ranking\n            \n            // Bonus factors (15 points total)\n            premiumAmenities: 5,    // Premium building amenities\n            locationRating: 5,      // Excellent location ratings\n            professionalPhotos: 3,  // Quality listing photos\n            floorLevel: 2,          // Higher floors preferred\n        };\n        \n        this.maxScore = 100;\n    }\n\n    calculateScore(apartment, searchCriteria = {\n        minRent: 4400,\n        maxRent: 5200,\n        zipCodePriority: {\n            '90066': 1,\n            '90230': 2, \n            '90232': 3,\n            '90034': 4\n        }\n    }) {\n        let totalScore = 0;\n        const scoreBreakdown = {};\n        \n        // Base Score: Rent within range (20 points)\n        const rentScore = this.calculateRentScore(apartment.price, searchCriteria);\n        scoreBreakdown.rent = rentScore;\n        totalScore += rentScore;\n        \n        // Mandatory amenities (30 points)\n        const amenityScore = this.calculateMandatoryAmenityScore(apartment);\n        scoreBreakdown.amenities = amenityScore;\n        totalScore += amenityScore;\n        \n        // Renovation recency (25 points)\n        const renovationScore = this.calculateRenovationScore(apartment);\n        scoreBreakdown.renovation = renovationScore;\n        totalScore += renovationScore;\n        \n        // Natural light (15 points)\n        const lightScore = this.calculateNaturalLightScore(apartment);\n        scoreBreakdown.naturalLight = lightScore;\n        totalScore += lightScore;\n        \n        // Outdoor space quality (10 points)\n        const outdoorScore = this.calculateOutdoorSpaceScore(apartment);\n        scoreBreakdown.outdoorSpace = outdoorScore;\n        totalScore += outdoorScore;\n        \n        // Zip code priority (10 points)\n        const locationScore = this.calculateZipCodeScore(apartment.zipCode, searchCriteria);\n        scoreBreakdown.location = locationScore;\n        totalScore += locationScore;\n        \n        // Bonus: Premium amenities (5 points)\n        const premiumScore = this.calculatePremiumAmenitiesScore(apartment);\n        scoreBreakdown.premiumAmenities = premiumScore;\n        totalScore += premiumScore;\n        \n        // Bonus: Location rating (5 points)\n        const ratingScore = this.calculateLocationRatingScore(apartment);\n        scoreBreakdown.locationRating = ratingScore;\n        totalScore += ratingScore;\n        \n        // Bonus: Professional photos (3 points)\n        const photoScore = this.calculatePhotoScore(apartment);\n        scoreBreakdown.photos = photoScore;\n        totalScore += photoScore;\n        \n        // Bonus: Floor level preference (2 points)\n        const floorScore = this.calculateFloorScore(apartment);\n        scoreBreakdown.floor = floorScore;\n        totalScore += floorScore;\n        \n        return Math.round(Math.min(totalScore, this.maxScore));\n    }\n\n    getScoreBreakdown(apartment, searchCriteria = {\n        minRent: 4400,\n        maxRent: 5200,\n        zipCodePriority: {\n            '90066': 1,\n            '90230': 2,\n            '90232': 3, \n            '90034': 4\n        }\n    }) {\n        const breakdown = {};\n        \n        breakdown.price = this.calculateRentScore(apartment.price, searchCriteria);\n        breakdown.specs = this.calculateMandatoryAmenityScore(apartment);\n        breakdown.floor = this.calculateFloorScore(apartment);\n        breakdown.features = this.calculateRenovationScore(apartment) + \n                           this.calculateNaturalLightScore(apartment) + \n                           this.calculateOutdoorSpaceScore(apartment);\n        breakdown.renovation = apartment.recentlyRenovated ? 10 : 0;\n        \n        breakdown.total = Math.min(\n            breakdown.price + breakdown.specs + breakdown.floor + \n            breakdown.features + breakdown.renovation, \n            100\n        );\n        \n        return breakdown;\n    }\n\n    calculateRentScore(price, searchCriteria) {\n        const { minRent, maxRent } = searchCriteria;\n        \n        if (price < minRent || price > maxRent) {\n            return 0;\n        }\n        \n        const optimalRent = (minRent + maxRent) / 2;\n        const maxDeviation = (maxRent - minRent) / 2;\n        const deviation = Math.abs(price - optimalRent);\n        const score = this.weights.rentInRange * (1 - deviation / maxDeviation);\n        \n        return Math.round(score);\n    }\n\n    calculateMandatoryAmenityScore(apartment) {\n        const requiredAmenities = {\n            washerDryer: false,\n            airConditioning: false,\n            outdoorSpace: false,\n            aboveGroundFloor: false\n        };\n        \n        const features = apartment.features.map(f => f.toLowerCase());\n        \n        requiredAmenities.washerDryer = features.some(f => \n            (f.includes('washer') && f.includes('dryer')) || \n            f.includes('w/d') || \n            f.includes('laundry')\n        );\n        \n        requiredAmenities.airConditioning = features.some(f => \n            f.includes('air') || \n            f.includes('conditioning') || \n            f.includes('hvac') ||\n            f.includes('central air')\n        );\n        \n        requiredAmenities.outdoorSpace = features.some(f => \n            f.includes('balcony') || \n            f.includes('patio') || \n            f.includes('terrace') ||\n            f.includes('deck') ||\n            f.includes('outdoor')\n        );\n        \n        requiredAmenities.aboveGroundFloor = apartment.floor > 1;\n        \n        const metRequirements = Object.values(requiredAmenities).filter(Boolean).length;\n        const totalRequirements = Object.keys(requiredAmenities).length;\n        const completionRate = metRequirements / totalRequirements;\n        \n        return Math.round(this.weights.mandatoryAmenities * completionRate);\n    }\n\n    calculateRenovationScore(apartment) {\n        const features = apartment.features.map(f => f.toLowerCase());\n        \n        const renovationKeywords = [\n            'renovated', 'updated', 'remodeled', 'modern', 'new',\n            'contemporary', 'upgraded', 'refreshed', 'redesigned'\n        ];\n        \n        const hasRenovationKeywords = features.some(f => \n            renovationKeywords.some(keyword => f.includes(keyword))\n        );\n        \n        const explicitlyRenovated = apartment.recentlyRenovated || false;\n        \n        const modernAmenities = [\n            'stainless steel', 'granite', 'quartz', 'hardwood',\n            'modern kitchen', 'designer', 'luxury'\n        ];\n        \n        const hasModernAmenities = features.some(f => \n            modernAmenities.some(amenity => f.includes(amenity))\n        );\n        \n        let score = 0;\n        \n        if (explicitlyRenovated) {\n            score = this.weights.renovationRecency;\n        } else if (hasRenovationKeywords && hasModernAmenities) {\n            score = this.weights.renovationRecency * 0.8;\n        } else if (hasRenovationKeywords || hasModernAmenities) {\n            score = this.weights.renovationRecency * 0.5;\n        } else {\n            score = this.weights.renovationRecency * 0.2;\n        }\n        \n        return Math.round(score);\n    }\n\n    calculateNaturalLightScore(apartment) {\n        const features = apartment.features.map(f => f.toLowerCase());\n        const description = apartment.description?.toLowerCase() || '';\n        \n        const lightKeywords = [\n            'natural light', 'bright', 'sunny', 'light-filled',\n            'windows', 'large windows', 'floor-to-ceiling',\n            'multiple exposures', 'corner unit'\n        ];\n        \n        const lightIndicators = features.concat([description]).some(text => \n            lightKeywords.some(keyword => text.includes(keyword))\n        );\n        \n        const floorBonus = apartment.floor > 5 ? 0.2 : 0;\n        \n        let score = 0;\n        \n        if (lightIndicators) {\n            score = this.weights.naturalLight * (0.8 + floorBonus);\n        } else {\n            score = this.weights.naturalLight * (0.4 + floorBonus);\n        }\n        \n        return Math.round(score);\n    }\n\n    calculateOutdoorSpaceScore(apartment) {\n        const features = apartment.features.map(f => f.toLowerCase());\n        \n        const outdoorSpaceTypes = {\n            'private balcony': 1.0,\n            'terrace': 1.0,\n            'private patio': 0.9,\n            'deck': 0.8,\n            'balcony': 0.7,\n            'patio': 0.6,\n            'outdoor': 0.5\n        };\n        \n        let maxScore = 0;\n        \n        for (const [spaceType, multiplier] of Object.entries(outdoorSpaceTypes)) {\n            if (features.some(f => f.includes(spaceType))) {\n                maxScore = Math.max(maxScore, this.weights.outdoorSpaceQuality * multiplier);\n            }\n        }\n        \n        return Math.round(maxScore);\n    }\n\n    calculateZipCodeScore(zipCode, searchCriteria) {\n        const priority = searchCriteria.zipCodePriority[zipCode] || 5;\n        const scoreMultiplier = Math.max(0, (5 - priority) / 4);\n        return Math.round(this.weights.zipCodePriority * scoreMultiplier);\n    }\n\n    calculatePremiumAmenitiesScore(apartment) {\n        const features = apartment.features.map(f => f.toLowerCase());\n        \n        const premiumAmenities = [\n            'swimming pool', 'fitness center', 'gym', 'concierge',\n            'doorman', 'roof deck', 'rooftop', 'parking garage',\n            'valet parking', 'business center', 'club room'\n        ];\n        \n        const premiumCount = features.filter(f => \n            premiumAmenities.some(amenity => f.includes(amenity))\n        ).length;\n        \n        const score = Math.min(premiumCount * 1.5, this.weights.premiumAmenities);\n        return Math.round(score);\n    }\n\n    calculateLocationRatingScore(apartment) {\n        const zipCodeRatings = {\n            '90066': 4.5,\n            '90230': 4.2,\n            '90232': 3.8,\n            '90034': 3.5\n        };\n        \n        const baseRating = zipCodeRatings[apartment.zipCode] || 3.0;\n        const priceBonus = apartment.price > 4800 ? 0.2 : 0;\n        const finalRating = Math.min(baseRating + priceBonus, 5.0);\n        const scoreMultiplier = Math.max(0, (finalRating - 3.0) / 2.0);\n        \n        return Math.round(this.weights.locationRating * scoreMultiplier);\n    }\n\n    calculatePhotoScore(apartment) {\n        const imageCount = apartment.images?.length || 0;\n        \n        if (imageCount >= 5) {\n            return this.weights.professionalPhotos;\n        } else if (imageCount >= 3) {\n            return Math.round(this.weights.professionalPhotos * 0.7);\n        } else if (imageCount >= 1) {\n            return Math.round(this.weights.professionalPhotos * 0.4);\n        } else {\n            return 0;\n        }\n    }\n\n    calculateFloorScore(apartment) {\n        const floor = apartment.floor || 2;\n        \n        if (floor >= 3 && floor <= 6) {\n            return this.weights.floorLevel;\n        } else if (floor === 2 || floor === 7 || floor === 8) {\n            return Math.round(this.weights.floorLevel * 0.7);\n        } else if (floor > 8) {\n            return Math.round(this.weights.floorLevel * 0.5);\n        } else {\n            return 0;\n        }\n    }\n}","export class UIComponents {\n    constructor() {\n        this.modal = null;\n        this.toastContainer = null;\n        this.init();\n    }\n\n    init() {\n        this.modal = document.getElementById('apartmentModal');\n        this.toastContainer = document.getElementById('toastContainer');\n        this.bindGlobalEvents();\n    }\n\n    bindGlobalEvents() {\n        // Global keyboard shortcuts\n        document.addEventListener('keydown', (e) => {\n            // ESC to close modal\n            if (e.key === 'Escape' && this.modal && this.modal.classList.contains('show')) {\n                this.closeModal();\n            }\n            \n            // Ctrl+F to focus on search\n            if (e.ctrlKey && e.key === 'f') {\n                e.preventDefault();\n                const searchBtn = document.getElementById('searchBtn');\n                if (searchBtn && searchBtn.style.display !== 'none') {\n                    searchBtn.focus();\n                }\n            }\n        });\n\n        // Handle window resize for responsive adjustments\n        window.addEventListener('resize', this.debounce(() => {\n            this.adjustLayoutForViewport();\n        }, 250));\n\n        // Handle scroll for sticky elements\n        window.addEventListener('scroll', this.throttle(() => {\n            this.handleScroll();\n        }, 100));\n    }\n\n    // Modal management\n    showModal(content, title = 'Details') {\n        if (!this.modal) return;\n\n        const modalTitle = this.modal.querySelector('#modalTitle');\n        const modalBody = this.modal.querySelector('#modalBody');\n\n        if (modalTitle) modalTitle.textContent = title;\n        if (modalBody) modalBody.innerHTML = content;\n\n        this.modal.style.display = 'flex';\n        setTimeout(() => {\n            this.modal.classList.add('show');\n            this.trapFocus(this.modal);\n        }, 10);\n\n        // Prevent body scroll when modal is open\n        document.body.style.overflow = 'hidden';\n    }\n\n    closeModal() {\n        if (!this.modal) return;\n\n        this.modal.classList.remove('show');\n        setTimeout(() => {\n            this.modal.style.display = 'none';\n            document.body.style.overflow = '';\n        }, 300);\n    }\n\n    // Toast notifications with enhanced features\n    showToast(message, type = 'info', duration = 4000, actions = null) {\n        if (!this.toastContainer) return;\n\n        const toast = document.createElement('div');\n        toast.className = `toast ${type}`;\n        \n        const iconMap = {\n            success: 'fa-check-circle',\n            error: 'fa-exclamation-circle',\n            warning: 'fa-exclamation-triangle',\n            info: 'fa-info-circle'\n        };\n\n        const icon = iconMap[type] || iconMap.info;\n        \n        let actionsHTML = '';\n        if (actions && actions.length > 0) {\n            actionsHTML = `\n                <div class=\"toast-actions\">\n                    ${actions.map(action => \n                        `<button class=\"toast-action\" data-action=\"${action.id}\">${action.label}</button>`\n                    ).join('')}\n                </div>\n            `;\n        }\n\n        toast.innerHTML = `\n            <div class=\"toast-content\">\n                <div class=\"toast-icon\">\n                    <i class=\"fas ${icon}\"></i>\n                </div>\n                <div class=\"toast-message\">\n                    <span>${message}</span>\n                    ${actionsHTML}\n                </div>\n                <button class=\"toast-close\">\n                    <i class=\"fas fa-times\"></i>\n                </button>\n            </div>\n        `;\n\n        // Add event listeners\n        const closeBtn = toast.querySelector('.toast-close');\n        closeBtn.addEventListener('click', () => this.removeToast(toast));\n\n        if (actions) {\n            toast.querySelectorAll('.toast-action').forEach(btn => {\n                btn.addEventListener('click', (e) => {\n                    const actionId = e.target.dataset.action;\n                    const action = actions.find(a => a.id === actionId);\n                    if (action && action.callback) {\n                        action.callback();\n                    }\n                    this.removeToast(toast);\n                });\n            });\n        }\n\n        this.toastContainer.appendChild(toast);\n        \n        // Trigger show animation\n        setTimeout(() => toast.classList.add('show'), 100);\n\n        // Auto-remove after duration\n        if (duration > 0) {\n            setTimeout(() => this.removeToast(toast), duration);\n        }\n\n        return toast;\n    }\n\n    removeToast(toast) {\n        if (!toast || !toast.parentNode) return;\n\n        toast.classList.remove('show');\n        setTimeout(() => {\n            if (toast.parentNode) {\n                toast.parentNode.removeChild(toast);\n            }\n        }, 300);\n    }\n\n    // Loading states\n    showLoadingSpinner(element, text = 'Loading...') {\n        if (!element) return;\n\n        const spinner = document.createElement('div');\n        spinner.className = 'loading-overlay';\n        spinner.innerHTML = `\n            <div class=\"spinner-container\">\n                <div class=\"spinner\"></div>\n                <span class=\"loading-text\">${text}</span>\n            </div>\n        `;\n\n        element.style.position = 'relative';\n        element.appendChild(spinner);\n\n        return spinner;\n    }\n\n    hideLoadingSpinner(element) {\n        if (!element) return;\n\n        const spinner = element.querySelector('.loading-overlay');\n        if (spinner) {\n            spinner.remove();\n        }\n    }\n\n    // Viewport and responsive utilities\n    adjustLayoutForViewport() {\n        const viewport = this.getViewportSize();\n        \n        // Adjust grid columns based on viewport\n        const resultsGrid = document.querySelector('.results-grid');\n        if (resultsGrid) {\n            if (viewport.width < 768) {\n                resultsGrid.style.gridTemplateColumns = '1fr';\n            } else if (viewport.width < 1200) {\n                resultsGrid.style.gridTemplateColumns = 'repeat(2, 1fr)';\n            } else {\n                resultsGrid.style.gridTemplateColumns = 'repeat(3, 1fr)';\n            }\n        }\n\n        // Adjust modal size on small screens\n        if (this.modal) {\n            const modalContent = this.modal.querySelector('.modal-content');\n            if (modalContent) {\n                if (viewport.width < 768) {\n                    modalContent.style.margin = '1rem';\n                    modalContent.style.maxHeight = 'calc(100vh - 2rem)';\n                } else {\n                    modalContent.style.margin = '2rem';\n                    modalContent.style.maxHeight = '90vh';\n                }\n            }\n        }\n    }\n\n    getViewportSize() {\n        return {\n            width: window.innerWidth,\n            height: window.innerHeight\n        };\n    }\n\n    // Scroll handling\n    handleScroll() {\n        const scrollY = window.scrollY;\n        \n        // Add shadow to header when scrolled\n        const header = document.querySelector('.header');\n        if (header) {\n            if (scrollY > 50) {\n                header.classList.add('scrolled');\n            } else {\n                header.classList.remove('scrolled');\n            }\n        }\n\n        // Show/hide back to top button\n        this.toggleBackToTop(scrollY > 300);\n    }\n\n    toggleBackToTop(show) {\n        let backToTopBtn = document.getElementById('backToTop');\n        \n        if (show && !backToTopBtn) {\n            backToTopBtn = document.createElement('button');\n            backToTopBtn.id = 'backToTop';\n            backToTopBtn.className = 'back-to-top';\n            backToTopBtn.innerHTML = '<i class=\"fas fa-chevron-up\"></i>';\n            backToTopBtn.addEventListener('click', () => {\n                window.scrollTo({ top: 0, behavior: 'smooth' });\n            });\n            document.body.appendChild(backToTopBtn);\n        }\n        \n        if (backToTopBtn) {\n            backToTopBtn.style.display = show ? 'block' : 'none';\n        }\n    }\n\n    // Focus management for accessibility\n    trapFocus(element) {\n        const focusableElements = element.querySelectorAll(\n            'button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])'\n        );\n        \n        const firstFocusable = focusableElements[0];\n        const lastFocusable = focusableElements[focusableElements.length - 1];\n        \n        if (firstFocusable) {\n            firstFocusable.focus();\n        }\n        \n        element.addEventListener('keydown', (e) => {\n            if (e.key === 'Tab') {\n                if (e.shiftKey) {\n                    if (document.activeElement === firstFocusable) {\n                        e.preventDefault();\n                        lastFocusable.focus();\n                    }\n                } else {\n                    if (document.activeElement === lastFocusable) {\n                        e.preventDefault();\n                        firstFocusable.focus();\n                    }\n                }\n            }\n        });\n    }\n\n    // Animation utilities\n    fadeIn(element, duration = 300) {\n        element.style.opacity = '0';\n        element.style.display = 'block';\n        \n        let start = null;\n        const animate = (timestamp) => {\n            if (!start) start = timestamp;\n            const progress = (timestamp - start) / duration;\n            \n            element.style.opacity = Math.min(progress, 1);\n            \n            if (progress < 1) {\n                requestAnimationFrame(animate);\n            }\n        };\n        \n        requestAnimationFrame(animate);\n    }\n\n    fadeOut(element, duration = 300) {\n        let start = null;\n        const animate = (timestamp) => {\n            if (!start) start = timestamp;\n            const progress = (timestamp - start) / duration;\n            \n            element.style.opacity = 1 - Math.min(progress, 1);\n            \n            if (progress >= 1) {\n                element.style.display = 'none';\n            } else {\n                requestAnimationFrame(animate);\n            }\n        };\n        \n        requestAnimationFrame(animate);\n    }\n\n    slideDown(element, duration = 300) {\n        element.style.height = '0';\n        element.style.overflow = 'hidden';\n        element.style.display = 'block';\n        \n        const targetHeight = element.scrollHeight;\n        let start = null;\n        \n        const animate = (timestamp) => {\n            if (!start) start = timestamp;\n            const progress = (timestamp - start) / duration;\n            \n            element.style.height = `${targetHeight * Math.min(progress, 1)}px`;\n            \n            if (progress >= 1) {\n                element.style.height = '';\n                element.style.overflow = '';\n            } else {\n                requestAnimationFrame(animate);\n            }\n        };\n        \n        requestAnimationFrame(animate);\n    }\n\n    slideUp(element, duration = 300) {\n        const startHeight = element.offsetHeight;\n        let start = null;\n        \n        const animate = (timestamp) => {\n            if (!start) start = timestamp;\n            const progress = (timestamp - start) / duration;\n            \n            element.style.height = `${startHeight * (1 - Math.min(progress, 1))}px`;\n            element.style.overflow = 'hidden';\n            \n            if (progress >= 1) {\n                element.style.display = 'none';\n                element.style.height = '';\n                element.style.overflow = '';\n            } else {\n                requestAnimationFrame(animate);\n            }\n        };\n        \n        requestAnimationFrame(animate);\n    }\n\n    // Utility functions\n    debounce(func, wait) {\n        let timeout;\n        return function executedFunction(...args) {\n            const later = () => {\n                clearTimeout(timeout);\n                func(...args);\n            };\n            clearTimeout(timeout);\n            timeout = setTimeout(later, wait);\n        };\n    }\n\n    throttle(func, limit) {\n        let inThrottle;\n        return function executedFunction(...args) {\n            if (!inThrottle) {\n                func.apply(this, args);\n                inThrottle = true;\n                setTimeout(() => inThrottle = false, limit);\n            }\n        };\n    }\n\n    // Format utilities\n    formatPrice(price) {\n        return new Intl.NumberFormat('en-US', {\n            style: 'currency',\n            currency: 'USD',\n            minimumFractionDigits: 0,\n            maximumFractionDigits: 0\n        }).format(price);\n    }\n\n    formatDate(date) {\n        return new Intl.DateTimeFormat('en-US', {\n            year: 'numeric',\n            month: 'short',\n            day: 'numeric'\n        }).format(new Date(date));\n    }\n\n    formatPhoneNumber(phone) {\n        const cleaned = phone.replace(/\\D/g, '');\n        const match = cleaned.match(/^(\\d{3})(\\d{3})(\\d{4})$/);\n        if (match) {\n            return `(${match[1]}) ${match[2]}-${match[3]}`;\n        }\n        return phone;\n    }\n\n    // Validation utilities\n    isValidEmail(email) {\n        const re = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n        return re.test(email);\n    }\n\n    isValidPhone(phone) {\n        const cleaned = phone.replace(/\\D/g, '');\n        return cleaned.length === 10;\n    }\n\n    // Local storage utilities\n    saveToStorage(key, data) {\n        try {\n            localStorage.setItem(key, JSON.stringify(data));\n            return true;\n        } catch (error) {\n            console.error('Error saving to localStorage:', error);\n            return false;\n        }\n    }\n\n    loadFromStorage(key, defaultValue = null) {\n        try {\n            const data = localStorage.getItem(key);\n            return data ? JSON.parse(data) : defaultValue;\n        } catch (error) {\n            console.error('Error loading from localStorage:', error);\n            return defaultValue;\n        }\n    }\n\n    removeFromStorage(key) {\n        try {\n            localStorage.removeItem(key);\n            return true;\n        } catch (error) {\n            console.error('Error removing from localStorage:', error);\n            return false;\n        }\n    }\n}\n\n// Export for use in other modules\nexport const UI = new UIComponents();","/**\n * Lazy Loading utility for property images with Intersection Observer\n * Optimizes performance by loading images only when they enter the viewport\n */\nexport class LazyImageLoader {\n    constructor(options = {}) {\n        this.options = {\n            rootMargin: '50px',\n            threshold: 0.1,\n            placeholderSrc: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZGVmcz48bGluZWFyR3JhZGllbnQgaWQ9ImciIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMTAwJSIgeTI9IjEwMCUiPjxzdG9wIG9mZnNldD0iMCUiIHN0b3AtY29sb3I9IiNmNWY1ZjUiLz48c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiNlZWVlZWUiLz48L2xpbmVhckdyYWRpZW50PjwvZGVmcz48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJ1cmwoI2cpIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNHB4IiBmaWxsPSIjOTk5OTk5IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkb21pbmFudC1iYXNlbGluZT0ibWlkZGxlIj5Mb2FkaW5nLi4uPC90ZXh0Pjwvc3ZnPg==',\n            errorSrc: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjVmNWY1Ii8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNHB4IiBmaWxsPSIjOTk5OTk5IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkb21pbmFudC1iYXNlbGluZT0ibWlkZGxlIj5JbWFnZSBVbmF2YWlsYWJsZTwvdGV4dD48L3N2Zz4=',\n            fadeInDuration: 300,\n            retryAttempts: 2,\n            retryDelay: 1000,\n            ...options\n        };\n\n        this.observer = null;\n        this.loadedImages = new Set();\n        this.failedImages = new Set();\n        this.retryCount = new Map();\n        \n        this.init();\n    }\n\n    init() {\n        if (!('IntersectionObserver' in window)) {\n            // Fallback for older browsers\n            this.loadAllImages();\n            return;\n        }\n\n        this.observer = new IntersectionObserver((entries) => {\n            entries.forEach(entry => {\n                if (entry.isIntersecting) {\n                    this.loadImage(entry.target);\n                }\n            });\n        }, {\n            rootMargin: this.options.rootMargin,\n            threshold: this.options.threshold\n        });\n\n        this.observeImages();\n    }\n\n    observeImages() {\n        const images = document.querySelectorAll('img[data-src]');\n        images.forEach(img => {\n            if (!this.loadedImages.has(img)) {\n                this.setupImageForLazyLoading(img);\n                this.observer.observe(img);\n            }\n        });\n    }\n\n    setupImageForLazyLoading(img) {\n        // Set placeholder if no src is set\n        if (!img.src || img.src === '') {\n            img.src = this.options.placeholderSrc;\n        }\n\n        // Add loading class\n        img.classList.add('lazy-loading');\n        \n        // Add loading indicator\n        this.addLoadingIndicator(img);\n\n        // Set initial opacity for fade effect\n        img.style.opacity = '0';\n        img.style.transition = `opacity ${this.options.fadeInDuration}ms ease-in-out`;\n    }\n\n    addLoadingIndicator(img) {\n        const container = img.parentElement;\n        if (!container.classList.contains('image-container')) {\n            // Wrap img in container if not already wrapped\n            const wrapper = document.createElement('div');\n            wrapper.className = 'image-container';\n            img.parentNode.insertBefore(wrapper, img);\n            wrapper.appendChild(img);\n        }\n\n        // Add loading indicator\n        if (!container.querySelector('.loading-indicator')) {\n            const indicator = document.createElement('div');\n            indicator.className = 'loading-indicator';\n            indicator.innerHTML = `\n                <div class=\"loading-spinner\">\n                    <div class=\"spinner\"></div>\n                </div>\n            `;\n            container.appendChild(indicator);\n        }\n    }\n\n    async loadImage(img) {\n        const src = img.getAttribute('data-src');\n        if (!src || this.loadedImages.has(img)) {\n            return;\n        }\n\n        try {\n            // Stop observing this image\n            if (this.observer) {\n                this.observer.unobserve(img);\n            }\n\n            // Pre-load the image\n            await this.preloadImage(src);\n\n            // Set the actual source\n            img.src = src;\n            img.removeAttribute('data-src');\n\n            // Add loaded class and fade in\n            img.classList.remove('lazy-loading');\n            img.classList.add('lazy-loaded');\n            \n            // Fade in effect\n            img.style.opacity = '1';\n\n            // Remove loading indicator\n            this.removeLoadingIndicator(img);\n\n            // Mark as loaded\n            this.loadedImages.add(img);\n\n            // Trigger custom event\n            img.dispatchEvent(new CustomEvent('lazyLoaded', {\n                detail: { src, img }\n            }));\n\n        } catch (error) {\n            console.warn('Failed to load image:', src, error);\n            await this.handleImageError(img, src);\n        }\n    }\n\n    preloadImage(src) {\n        return new Promise((resolve, reject) => {\n            const img = new Image();\n            \n            img.onload = () => resolve(img);\n            img.onerror = () => reject(new Error(`Failed to load image: ${src}`));\n            \n            // Set a timeout for the image load\n            setTimeout(() => {\n                reject(new Error(`Image load timeout: ${src}`));\n            }, 10000);\n            \n            img.src = src;\n        });\n    }\n\n    async handleImageError(img, originalSrc) {\n        const retryKey = originalSrc;\n        const currentRetries = this.retryCount.get(retryKey) || 0;\n\n        if (currentRetries < this.options.retryAttempts) {\n            // Retry loading\n            this.retryCount.set(retryKey, currentRetries + 1);\n            \n            await new Promise(resolve => setTimeout(resolve, this.options.retryDelay));\n            \n            try {\n                await this.preloadImage(originalSrc);\n                img.src = originalSrc;\n                img.removeAttribute('data-src');\n                img.classList.remove('lazy-loading');\n                img.classList.add('lazy-loaded');\n                img.style.opacity = '1';\n                this.removeLoadingIndicator(img);\n                this.loadedImages.add(img);\n                return;\n            } catch (retryError) {\n                console.warn(`Retry ${currentRetries + 1} failed for image:`, originalSrc);\n            }\n        }\n\n        // Final fallback\n        img.src = this.options.errorSrc;\n        img.classList.remove('lazy-loading');\n        img.classList.add('lazy-error');\n        img.style.opacity = '1';\n        this.removeLoadingIndicator(img);\n        this.failedImages.add(img);\n\n        // Trigger error event\n        img.dispatchEvent(new CustomEvent('lazyLoadError', {\n            detail: { originalSrc, img }\n        }));\n    }\n\n    removeLoadingIndicator(img) {\n        const container = img.parentElement;\n        const indicator = container.querySelector('.loading-indicator');\n        if (indicator) {\n            indicator.classList.add('fade-out');\n            setTimeout(() => {\n                if (indicator.parentNode) {\n                    indicator.parentNode.removeChild(indicator);\n                }\n            }, 200);\n        }\n    }\n\n    // Fallback for browsers without Intersection Observer\n    loadAllImages() {\n        const images = document.querySelectorAll('img[data-src]');\n        images.forEach(img => {\n            this.setupImageForLazyLoading(img);\n            this.loadImage(img);\n        });\n    }\n\n    // Refresh observer for dynamically added images\n    refresh() {\n        if (this.observer) {\n            this.observeImages();\n        }\n    }\n\n    // Add new images to be lazy loaded\n    observe(images) {\n        if (!this.observer) return;\n\n        const imgArray = Array.isArray(images) ? images : [images];\n        imgArray.forEach(img => {\n            if (img.tagName === 'IMG' && img.hasAttribute('data-src')) {\n                this.setupImageForLazyLoading(img);\n                this.observer.observe(img);\n            }\n        });\n    }\n\n    // Manually load specific images\n    loadImagesInContainer(container) {\n        const images = container.querySelectorAll('img[data-src]');\n        images.forEach(img => this.loadImage(img));\n    }\n\n    // Get loading statistics\n    getStats() {\n        return {\n            loaded: this.loadedImages.size,\n            failed: this.failedImages.size,\n            pending: document.querySelectorAll('img[data-src]').length\n        };\n    }\n\n    // Destroy the lazy loader\n    destroy() {\n        if (this.observer) {\n            this.observer.disconnect();\n            this.observer = null;\n        }\n        this.loadedImages.clear();\n        this.failedImages.clear();\n        this.retryCount.clear();\n    }\n}\n\n// Create singleton instance\nexport const lazyLoader = new LazyImageLoader();\n\n// Auto-initialize when DOM is ready\nif (typeof window !== 'undefined') {\n    if (document.readyState === 'loading') {\n        document.addEventListener('DOMContentLoaded', () => {\n            lazyLoader.refresh();\n        });\n    } else {\n        lazyLoader.refresh();\n    }\n}","import { ApartmentSearchEngine } from './search-engine.js';\nimport { ApartmentScoring } from './scoring.js';\nimport { UIComponents } from './ui-components.js';\nimport { lazyLoader } from './lazy-loading.js';\n\nexport class ApartmentFinderApp {\n    constructor() {\n        this.apartments = [];\n        this.filteredApartments = [];\n        this.bookmarkedApartments = JSON.parse(localStorage.getItem('bookmarkedApartments') || '[]');\n        this.isSearching = false;\n        \n        this.init();\n    }\n\n    init() {\n        this.bindEvents();\n        this.loadBookmarks();\n        console.log('Apartment Finder App initialized');\n    }\n\n    bindEvents() {\n        // Search button\n        const searchBtn = document.getElementById('searchBtn');\n        searchBtn.addEventListener('click', () => this.startSearch());\n\n        // Filter controls\n        const sortBy = document.getElementById('sortBy');\n        sortBy.addEventListener('change', () => this.applyFilters());\n\n        const minScore = document.getElementById('minScore');\n        minScore.addEventListener('input', (e) => {\n            document.getElementById('minScoreValue').textContent = e.target.value;\n            this.applyFilters();\n        });\n\n        // Filter checkboxes\n        ['recentOnly', 'renovatedOnly', 'premiumOnly'].forEach(id => {\n            document.getElementById(id).addEventListener('change', () => this.applyFilters());\n        });\n\n        // Filter panel toggle\n        const toggleFilters = document.getElementById('toggleFilters');\n        const filterContent = document.querySelector('.filter-content');\n        toggleFilters.addEventListener('click', () => {\n            const isExpanded = filterContent.style.display !== 'none';\n            filterContent.style.display = isExpanded ? 'none' : 'block';\n            toggleFilters.innerHTML = isExpanded ? \n                '<i class=\"fas fa-chevron-down\"></i>' : \n                '<i class=\"fas fa-chevron-up\"></i>';\n        });\n\n        // Modal controls\n        const modal = document.getElementById('apartmentModal');\n        const closeModal = document.getElementById('closeModal');\n        \n        closeModal.addEventListener('click', () => this.closeModal());\n        modal.addEventListener('click', (e) => {\n            if (e.target === modal) this.closeModal();\n        });\n\n        // Export button\n        const exportBtn = document.getElementById('exportBtn');\n        exportBtn.addEventListener('click', () => this.exportResults());\n\n        // Keyboard shortcuts\n        document.addEventListener('keydown', (e) => {\n            if (e.key === 'Escape' && modal.style.display !== 'none') {\n                this.closeModal();\n            }\n            if (e.key === 'Enter' && e.ctrlKey && !this.isSearching) {\n                this.startSearch();\n            }\n        });\n    }\n\n    async startSearch() {\n        if (this.isSearching) return;\n        \n        this.isSearching = true;\n        this.showLoadingState();\n        \n        try {\n            // Initialize search engine and scoring\n            const searchEngine = new ApartmentSearchEngine();\n            const scorer = new ApartmentScoring();\n            \n            // Start search with progress updates\n            const apartments = await searchEngine.searchApartments((progress) => {\n                this.updateProgress(progress);\n            });\n            \n            // Score apartments using the scoring system\n            this.apartments = apartments.map(apt => ({\n                ...apt,\n                score: scorer.calculateScore(apt),\n                scoreBreakdown: scorer.getScoreBreakdown(apt)\n            }));\n            this.applyFilters();\n            this.showResults();\n            \n        } catch (error) {\n            console.error('Search failed:', error);\n            this.showToast('Search failed. Please try again.', 'error');\n        } finally {\n            this.isSearching = false;\n            this.hideLoadingState();\n        }\n    }\n\n    showLoadingState() {\n        const searchBtn = document.getElementById('searchBtn');\n        const loadingIndicator = document.getElementById('loadingIndicator');\n        \n        searchBtn.style.display = 'none';\n        loadingIndicator.style.display = 'block';\n        \n        // Hide results section\n        document.getElementById('resultsSection').style.display = 'none';\n        document.getElementById('filterPanel').style.display = 'none';\n    }\n\n    hideLoadingState() {\n        const searchBtn = document.getElementById('searchBtn');\n        const loadingIndicator = document.getElementById('loadingIndicator');\n        \n        searchBtn.style.display = 'inline-block';\n        loadingIndicator.style.display = 'none';\n    }\n\n    updateProgress(progress) {\n        const steps = ['step1', 'step2', 'step3', 'step4'];\n        const currentStep = Math.min(Math.floor(progress / 25), 3);\n        \n        steps.forEach((stepId, index) => {\n            const element = document.getElementById(stepId);\n            if (index < currentStep) {\n                element.className = 'step completed';\n            } else if (index === currentStep) {\n                element.className = 'step active';\n            } else {\n                element.className = 'step';\n            }\n        });\n    }\n\n    applyFilters() {\n        if (!this.apartments.length) return;\n\n        let filtered = [...this.apartments];\n        \n        // Apply score filter\n        const minScore = parseInt(document.getElementById('minScore').value);\n        filtered = filtered.filter(apt => apt.score >= minScore);\n        \n        // Apply checkbox filters\n        if (document.getElementById('recentOnly').checked) {\n            const weekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);\n            filtered = filtered.filter(apt => new Date(apt.datePosted) > weekAgo);\n        }\n        \n        if (document.getElementById('renovatedOnly').checked) {\n            filtered = filtered.filter(apt => apt.recentlyRenovated);\n        }\n        \n        if (document.getElementById('premiumOnly').checked) {\n            filtered = filtered.filter(apt => apt.premiumAmenities);\n        }\n        \n        // Apply sorting\n        const sortBy = document.getElementById('sortBy').value;\n        filtered.sort((a, b) => {\n            switch (sortBy) {\n                case 'score': return b.score - a.score;\n                case 'price-low': return a.price - b.price;\n                case 'price-high': return b.price - a.price;\n                case 'newest': return new Date(b.datePosted) - new Date(a.datePosted);\n                default: return b.score - a.score;\n            }\n        });\n        \n        this.filteredApartments = filtered;\n        this.renderResults();\n    }\n\n    showResults() {\n        document.getElementById('resultsSection').style.display = 'block';\n        document.getElementById('filterPanel').style.display = 'block';\n        \n        // Scroll to results\n        document.getElementById('resultsSection').scrollIntoView({ \n            behavior: 'smooth' \n        });\n    }\n\n    renderResults() {\n        const resultsGrid = document.getElementById('resultsGrid');\n        const recentResults = document.getElementById('recentResults');\n        const recentListings = document.getElementById('recentListings');\n        const noResults = document.getElementById('noResults');\n        const resultsCount = document.getElementById('resultsCount');\n        \n        // Update results count\n        resultsCount.textContent = `${this.filteredApartments.length} apartments found`;\n        \n        if (this.filteredApartments.length === 0) {\n            resultsGrid.innerHTML = '';\n            recentResults.innerHTML = '';\n            recentListings.style.display = 'none';\n            noResults.style.display = 'block';\n            return;\n        }\n        \n        noResults.style.display = 'none';\n        \n        // Separate recent listings (past week)\n        const weekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);\n        const recentApartments = this.filteredApartments.filter(apt => \n            new Date(apt.datePosted) > weekAgo\n        );\n        const allApartments = this.filteredApartments;\n        \n        // Render recent listings\n        if (recentApartments.length > 0) {\n            recentListings.style.display = 'block';\n            recentResults.innerHTML = recentApartments\n                .slice(0, 6)\n                .map(apt => this.createApartmentCard(apt, true))\n                .join('');\n        } else {\n            recentListings.style.display = 'none';\n        }\n        \n        // Render all results\n        resultsGrid.innerHTML = allApartments\n            .map(apt => this.createApartmentCard(apt))\n            .join('');\n        \n        // Add click events to apartment cards\n        document.querySelectorAll('.apartment-card').forEach(card => {\n            card.addEventListener('click', () => {\n                const apartmentId = card.dataset.apartmentId;\n                const apartment = this.apartments.find(apt => apt.id === apartmentId);\n                this.showApartmentDetails(apartment);\n            });\n        });\n\n        // Initialize lazy loading for new images\n        setTimeout(() => {\n            lazyLoader.refresh();\n        }, 100);\n    }\n\n    createApartmentCard(apartment, isRecent = false) {\n        const scoreClass = apartment.score >= 80 ? 'high' : \n                          apartment.score >= 60 ? 'medium' : 'low';\n        \n        const features = apartment.features.slice(0, 3).map(feature => \n            `<span class=\"feature-tag ${apartment.highlightFeatures?.includes(feature) ? 'highlight' : ''}\">${feature}</span>`\n        ).join('');\n        \n        const bookmarked = this.bookmarkedApartments.includes(apartment.id);\n        \n        return `\n            <div class=\"apartment-card fade-in\" data-apartment-id=\"${apartment.id}\">\n                <div class=\"card-image\">\n                    <div class=\"image-container\">\n                        ${apartment.images && apartment.images.length > 0 ? \n                            `<img class=\"property-image\" data-src=\"${apartment.images[0]}\" alt=\"${apartment.title}\" onerror=\"this.classList.add('lazy-error')\">` :\n                            '<div class=\"no-image-placeholder\"><i class=\"fas fa-image\"></i><span>No Image Available</span></div>'\n                        }\n                    </div>\n                    <div class=\"score-badge ${scoreClass}\">${apartment.score}</div>\n                    ${bookmarked ? '<div class=\"bookmark-indicator\"><i class=\"fas fa-bookmark\"></i></div>' : ''}\n                </div>\n                <div class=\"card-content\">\n                    <h3 class=\"card-title\">${apartment.title}</h3>\n                    <p class=\"card-address\">\n                        <i class=\"fas fa-map-marker-alt\"></i>\n                        ${apartment.address}\n                    </p>\n                    \n                    <div class=\"card-details\">\n                        <div class=\"detail-item\">\n                            <i class=\"fas fa-bed\"></i>\n                            ${apartment.bedrooms} bed\n                        </div>\n                        <div class=\"detail-item\">\n                            <i class=\"fas fa-bath\"></i>\n                            ${apartment.bathrooms} bath\n                        </div>\n                        <div class=\"detail-item\">\n                            <i class=\"fas fa-ruler-combined\"></i>\n                            ${apartment.sqft || 'N/A'} sq ft\n                        </div>\n                        <div class=\"detail-item\">\n                            <i class=\"fas fa-building\"></i>\n                            Floor ${apartment.floor || 'N/A'}\n                        </div>\n                    </div>\n                    \n                    <div class=\"card-features\">\n                        ${features}\n                        ${apartment.features.length > 3 ? \n                            `<span class=\"feature-tag\">+${apartment.features.length - 3} more</span>` : \n                            ''\n                        }\n                    </div>\n                    \n                    <div class=\"card-price\">$${apartment.price.toLocaleString()}/month</div>\n                    \n                    <div class=\"card-actions\">\n                        <a href=\"${apartment.url}\" target=\"_blank\" rel=\"noopener noreferrer\" class=\"view-listing-btn\" onclick=\"event.stopPropagation();\">\n                            <i class=\"fas fa-external-link-alt\"></i>\n                            View Listing\n                        </a>\n                        <span class=\"listing-source\">via ${apartment.source}</span>\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n\n    showApartmentDetails(apartment) {\n        const modal = document.getElementById('apartmentModal');\n        const modalTitle = document.getElementById('modalTitle');\n        const modalBody = document.getElementById('modalBody');\n        const bookmarkBtn = document.getElementById('bookmarkBtn');\n        \n        modalTitle.textContent = apartment.title;\n        \n        const scoreClass = apartment.score >= 80 ? 'high' : \n                          apartment.score >= 60 ? 'medium' : 'low';\n        \n        const imageGallery = apartment.images && apartment.images.length > 0 ? \n            `<div class=\"image-gallery\">\n                ${apartment.images.map((img, index) => \n                    `<div class=\"image-container\" style=\"margin-bottom: 1rem;\">\n                        <img class=\"property-image\" \n                             ${index === 0 ? `src=\"${img}\"` : `data-src=\"${img}\"`} \n                             alt=\"Apartment image\" \n                             style=\"width: 100%; border-radius: 8px;\"\n                             onerror=\"this.classList.add('lazy-error')\">\n                    </div>`\n                ).join('')}\n            </div>` : \n            '<div class=\"no-image\">No images available</div>';\n        \n        modalBody.innerHTML = `\n            ${imageGallery}\n            \n            <div class=\"apartment-details\">\n                <div class=\"detail-header\">\n                    <div class=\"score-display\">\n                        <span class=\"score-badge ${scoreClass}\">${apartment.score}</span>\n                        <span class=\"score-label\">Match Score</span>\n                    </div>\n                    <div class=\"price-display\">\n                        <span class=\"price\">$${apartment.price.toLocaleString()}</span>\n                        <span class=\"price-label\">per month</span>\n                    </div>\n                </div>\n                \n                <div class=\"address-section\">\n                    <h4><i class=\"fas fa-map-marker-alt\"></i> Address</h4>\n                    <p>${apartment.address}</p>\n                    <p><strong>Zip Code:</strong> ${apartment.zipCode}</p>\n                </div>\n                \n                <div class=\"specs-section\">\n                    <h4><i class=\"fas fa-info-circle\"></i> Specifications</h4>\n                    <div class=\"specs-grid\">\n                        <div class=\"spec-item\">\n                            <i class=\"fas fa-bed\"></i>\n                            <span>${apartment.bedrooms} Bedrooms</span>\n                        </div>\n                        <div class=\"spec-item\">\n                            <i class=\"fas fa-bath\"></i>\n                            <span>${apartment.bathrooms} Bathrooms</span>\n                        </div>\n                        <div class=\"spec-item\">\n                            <i class=\"fas fa-ruler-combined\"></i>\n                            <span>${apartment.sqft || 'N/A'} sq ft</span>\n                        </div>\n                        <div class=\"spec-item\">\n                            <i class=\"fas fa-building\"></i>\n                            <span>Floor ${apartment.floor || 'N/A'}</span>\n                        </div>\n                    </div>\n                </div>\n                \n                <div class=\"amenities-section\">\n                    <h4><i class=\"fas fa-star\"></i> Amenities & Features</h4>\n                    <div class=\"amenities-grid\">\n                        ${apartment.features.map(feature => \n                            `<div class=\"amenity-item ${apartment.highlightFeatures?.includes(feature) ? 'highlight' : ''}\">\n                                <i class=\"fas fa-check\"></i>\n                                ${feature}\n                            </div>`\n                        ).join('')}\n                    </div>\n                </div>\n                \n                ${apartment.description ? `\n                    <div class=\"description-section\">\n                        <h4><i class=\"fas fa-file-text\"></i> Description</h4>\n                        <p>${apartment.description}</p>\n                    </div>\n                ` : ''}\n                \n                <div class=\"listing-url-section\">\n                    <h4><i class=\"fas fa-external-link-alt\"></i> View Full Listing</h4>\n                    <div class=\"url-container\">\n                        <a href=\"${apartment.url}\" target=\"_blank\" rel=\"noopener noreferrer\" class=\"modal-view-listing-btn\">\n                            <i class=\"fas fa-external-link-alt\"></i>\n                            View on ${apartment.source}\n                        </a>\n                        <p class=\"url-disclaimer\">Opens in a new tab. Listing provided by ${apartment.source}.</p>\n                    </div>\n                </div>\n                \n                <div class=\"contact-section\">\n                    <h4><i class=\"fas fa-phone\"></i> Contact Information</h4>\n                    <p><strong>Phone:</strong> ${apartment.contact?.phone || 'Not available'}</p>\n                    <p><strong>Email:</strong> ${apartment.contact?.email || 'Not available'}</p>\n                    <p><strong>Source:</strong> ${apartment.source}</p>\n                    <p><strong>Posted:</strong> ${new Date(apartment.datePosted).toLocaleDateString()}</p>\n                </div>\n            </div>\n        `;\n        \n        // Update bookmark button\n        const isBookmarked = this.bookmarkedApartments.includes(apartment.id);\n        bookmarkBtn.innerHTML = isBookmarked ? \n            '<i class=\"fas fa-bookmark\"></i> Bookmarked' : \n            '<i class=\"far fa-bookmark\"></i> Bookmark';\n        \n        bookmarkBtn.onclick = () => this.toggleBookmark(apartment.id);\n        \n        // Show modal\n        modal.style.display = 'flex';\n        setTimeout(() => {\n            modal.classList.add('show');\n            // Initialize lazy loading for modal images\n            lazyLoader.refresh();\n        }, 10);\n    }\n\n    closeModal() {\n        const modal = document.getElementById('apartmentModal');\n        modal.classList.remove('show');\n        setTimeout(() => modal.style.display = 'none', 300);\n    }\n\n    toggleBookmark(apartmentId) {\n        const index = this.bookmarkedApartments.indexOf(apartmentId);\n        if (index > -1) {\n            this.bookmarkedApartments.splice(index, 1);\n            this.showToast('Bookmark removed', 'warning');\n        } else {\n            this.bookmarkedApartments.push(apartmentId);\n            this.showToast('Apartment bookmarked!', 'success');\n        }\n        \n        localStorage.setItem('bookmarkedApartments', JSON.stringify(this.bookmarkedApartments));\n        this.renderResults(); // Re-render to update bookmark indicators\n        \n        // Update bookmark button in modal\n        const bookmarkBtn = document.getElementById('bookmarkBtn');\n        const isBookmarked = this.bookmarkedApartments.includes(apartmentId);\n        bookmarkBtn.innerHTML = isBookmarked ? \n            '<i class=\"fas fa-bookmark\"></i> Bookmarked' : \n            '<i class=\"far fa-bookmark\"></i> Bookmark';\n    }\n\n    loadBookmarks() {\n        console.log(`Loaded ${this.bookmarkedApartments.length} bookmarked apartments`);\n    }\n\n    exportResults() {\n        if (this.filteredApartments.length === 0) {\n            this.showToast('No results to export', 'warning');\n            return;\n        }\n        \n        const exportData = this.filteredApartments.map(apt => ({\n            title: apt.title,\n            address: apt.address,\n            price: apt.price,\n            bedrooms: apt.bedrooms,\n            bathrooms: apt.bathrooms,\n            sqft: apt.sqft,\n            score: apt.score,\n            features: apt.features.join(', '),\n            contact: apt.contact?.phone || '',\n            source: apt.source,\n            datePosted: apt.datePosted\n        }));\n        \n        const csv = this.convertToCSV(exportData);\n        this.downloadCSV(csv, 'apartment-search-results.csv');\n        this.showToast('Results exported successfully!', 'success');\n    }\n\n    convertToCSV(data) {\n        const headers = Object.keys(data[0]).join(',');\n        const rows = data.map(row => \n            Object.values(row).map(value => \n                typeof value === 'string' && value.includes(',') ? \n                    `\"${value}\"` : value\n            ).join(',')\n        );\n        return [headers, ...rows].join('\\n');\n    }\n\n    downloadCSV(csv, filename) {\n        const blob = new Blob([csv], { type: 'text/csv' });\n        const url = window.URL.createObjectURL(blob);\n        const a = document.createElement('a');\n        a.setAttribute('hidden', '');\n        a.setAttribute('href', url);\n        a.setAttribute('download', filename);\n        document.body.appendChild(a);\n        a.click();\n        document.body.removeChild(a);\n        window.URL.revokeObjectURL(url);\n    }\n\n    showToast(message, type = 'success') {\n        const container = document.getElementById('toastContainer');\n        const toast = document.createElement('div');\n        toast.className = `toast ${type}`;\n        toast.innerHTML = `\n            <div class=\"toast-content\">\n                <i class=\"fas fa-${type === 'success' ? 'check-circle' : \n                                 type === 'error' ? 'exclamation-circle' : \n                                 'exclamation-triangle'}\"></i>\n                <span>${message}</span>\n            </div>\n        `;\n        \n        container.appendChild(toast);\n        setTimeout(() => toast.classList.add('show'), 100);\n        \n        setTimeout(() => {\n            toast.classList.remove('show');\n            setTimeout(() => container.removeChild(toast), 300);\n        }, 4000);\n    }\n}\n\n// Initialize app when DOM is loaded\nif (typeof window !== 'undefined') {\n    document.addEventListener('DOMContentLoaded', () => {\n        new ApartmentFinderApp();\n    });\n}","export class ClaudeIntegration {\n    constructor() {\n        this.apiKey = null; // Will be set by user in settings\n        this.baseURL = 'https://api.anthropic.com/v1/messages';\n        this.model = 'claude-3-sonnet-20240229';\n        this.maxTokens = 1000;\n        \n        this.init();\n    }\n\n    init() {\n        // Check for stored API key\n        this.apiKey = localStorage.getItem('claude_api_key');\n        \n        // Create settings panel if API key is not set\n        if (!this.apiKey) {\n            this.showAPIKeySetup();\n        }\n    }\n\n    showAPIKeySetup() {\n        const existingSetup = document.getElementById('apiKeySetup');\n        if (existingSetup) return;\n\n        const setupPanel = document.createElement('div');\n        setupPanel.id = 'apiKeySetup';\n        setupPanel.className = 'api-key-setup';\n        setupPanel.innerHTML = `\n            <div class=\"setup-content\">\n                <h3><i class=\"fas fa-key\"></i> API Configuration</h3>\n                <p>To enable Claude AI enhanced search features, please enter your Anthropic API key:</p>\n                <div class=\"input-group\">\n                    <input type=\"password\" id=\"apiKeyInput\" placeholder=\"sk-ant-api...\" />\n                    <button id=\"saveApiKey\" class=\"btn-primary\">Save</button>\n                </div>\n                <div class=\"setup-info\">\n                    <p><small>\n                        <i class=\"fas fa-info-circle\"></i>\n                        Your API key is stored locally and never shared. \n                        <a href=\"https://console.anthropic.com/\" target=\"_blank\">Get your API key here</a>\n                    </small></p>\n                </div>\n                <button id=\"skipApiKey\" class=\"btn-secondary\">Skip (Use Mock Data)</button>\n            </div>\n        `;\n\n        document.body.appendChild(setupPanel);\n\n        // Bind events\n        document.getElementById('saveApiKey').addEventListener('click', () => {\n            const apiKey = document.getElementById('apiKeyInput').value.trim();\n            if (apiKey) {\n                this.setAPIKey(apiKey);\n                setupPanel.remove();\n            }\n        });\n\n        document.getElementById('skipApiKey').addEventListener('click', () => {\n            setupPanel.remove();\n        });\n\n        document.getElementById('apiKeyInput').addEventListener('keypress', (e) => {\n            if (e.key === 'Enter') {\n                document.getElementById('saveApiKey').click();\n            }\n        });\n    }\n\n    setAPIKey(apiKey) {\n        this.apiKey = apiKey;\n        localStorage.setItem('claude_api_key', apiKey);\n        console.log('Claude API key configured');\n    }\n\n    async enhanceApartmentDescriptions(apartments) {\n        if (!this.apiKey || apartments.length === 0) {\n            return apartments; // Return as-is if no API key or no apartments\n        }\n\n        try {\n            const prompt = this.buildDescriptionEnhancementPrompt(apartments);\n            const response = await this.callClaudeAPI(prompt);\n            \n            if (response && response.enhanced_descriptions) {\n                return this.applyEnhancedDescriptions(apartments, response.enhanced_descriptions);\n            }\n        } catch (error) {\n            console.error('Error enhancing descriptions:', error);\n        }\n\n        return apartments;\n    }\n\n    async generateSearchInsights(apartments) {\n        if (!this.apiKey || apartments.length === 0) {\n            return null;\n        }\n\n        try {\n            const prompt = this.buildInsightsPrompt(apartments);\n            const response = await this.callClaudeAPI(prompt);\n            \n            return response;\n        } catch (error) {\n            console.error('Error generating insights:', error);\n            return null;\n        }\n    }\n\n    buildDescriptionEnhancementPrompt(apartments) {\n        const apartmentSummaries = apartments.slice(0, 10).map((apt, index) => ({\n            id: index,\n            title: apt.title,\n            address: apt.address,\n            price: apt.price,\n            features: apt.features.slice(0, 6),\n            score: apt.score\n        }));\n\n        return `\nYou are a real estate expert helping to enhance apartment descriptions for a luxury apartment search in West Los Angeles. \n\nHere are ${apartmentSummaries.length} apartments that match the search criteria:\n\n${JSON.stringify(apartmentSummaries, null, 2)}\n\nPlease provide enhanced descriptions for these apartments that:\n1. Highlight the most appealing features\n2. Use professional real estate language\n3. Emphasize luxury and comfort aspects\n4. Keep descriptions concise (2-3 sentences)\n5. Focus on what makes each apartment unique\n\nRespond in JSON format:\n{\n  \"enhanced_descriptions\": [\n    {\n      \"id\": 0,\n      \"enhanced_description\": \"Enhanced description here...\"\n    }\n  ]\n}\n        `;\n    }\n\n    buildInsightsPrompt(apartments) {\n        const topApartments = apartments.slice(0, 5);\n        const avgPrice = apartments.reduce((sum, apt) => sum + apt.price, 0) / apartments.length;\n        const scoreDistribution = {\n            high: apartments.filter(apt => apt.score >= 80).length,\n            medium: apartments.filter(apt => apt.score >= 60 && apt.score < 80).length,\n            low: apartments.filter(apt => apt.score < 60).length\n        };\n\n        return `\nYou are a real estate market analyst. Analyze this apartment search data for West Los Angeles and provide insights.\n\nSearch Results Summary:\n- Total apartments found: ${apartments.length}\n- Average price: $${Math.round(avgPrice)}\n- Score distribution: ${scoreDistribution.high} high-scoring, ${scoreDistribution.medium} medium-scoring, ${scoreDistribution.low} low-scoring\n\nTop 5 apartments:\n${JSON.stringify(topApartments.map(apt => ({\n    title: apt.title,\n    address: apt.address,\n    price: apt.price,\n    score: apt.score,\n    zipCode: apt.zipCode\n})), null, 2)}\n\nPlease provide:\n1. Market insights about pricing trends\n2. Best value recommendations\n3. Areas to focus on for better options\n4. Red flags to watch for\n5. Negotiation opportunities\n\nRespond in JSON format with actionable insights.\n        `;\n    }\n\n    async callClaudeAPI(prompt) {\n        if (!this.apiKey) {\n            throw new Error('API key not configured');\n        }\n\n        const response = await fetch(this.baseURL, {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n                'x-api-key': this.apiKey,\n                'anthropic-version': '2023-06-01'\n            },\n            body: JSON.stringify({\n                model: this.model,\n                max_tokens: this.maxTokens,\n                messages: [{\n                    role: 'user',\n                    content: prompt\n                }]\n            })\n        });\n\n        if (!response.ok) {\n            throw new Error(`API call failed: ${response.status} ${response.statusText}`);\n        }\n\n        const data = await response.json();\n        \n        try {\n            return JSON.parse(data.content[0].text);\n        } catch (parseError) {\n            console.error('Error parsing Claude response:', parseError);\n            return { error: 'Failed to parse response' };\n        }\n    }\n\n    applyEnhancedDescriptions(apartments, enhancedDescriptions) {\n        const enhancedMap = new Map();\n        enhancedDescriptions.forEach(item => {\n            enhancedMap.set(item.id, item.enhanced_description);\n        });\n\n        return apartments.map((apartment, index) => {\n            if (index < 10 && enhancedMap.has(index)) {\n                return {\n                    ...apartment,\n                    description: enhancedMap.get(index),\n                    enhanced: true\n                };\n            }\n            return apartment;\n        });\n    }\n\n    // Smart filtering using Claude AI\n    async intelligentFilter(apartments, userQuery) {\n        if (!this.apiKey || !userQuery.trim()) {\n            return apartments;\n        }\n\n        try {\n            const prompt = `\nYou are helping filter apartment listings based on user preferences. \n\nUser query: \"${userQuery}\"\n\nAvailable apartments (showing first 20):\n${JSON.stringify(apartments.slice(0, 20).map(apt => ({\n    id: apt.id,\n    title: apt.title,\n    address: apt.address,\n    price: apt.price,\n    features: apt.features,\n    score: apt.score\n})), null, 2)}\n\nBased on the user query, rank these apartments and explain why each is relevant or not relevant.\nFocus on matching user intent, not just keywords.\n\nRespond in JSON format:\n{\n  \"filtered_apartments\": [\n    {\n      \"id\": \"apartment_id\",\n      \"relevance_score\": 85,\n      \"reason\": \"Why this apartment matches the query\"\n    }\n  ]\n}\n            `;\n\n            const response = await this.callClaudeAPI(prompt);\n            \n            if (response && response.filtered_apartments) {\n                return this.applyIntelligentFiltering(apartments, response.filtered_apartments);\n            }\n        } catch (error) {\n            console.error('Error in intelligent filtering:', error);\n        }\n\n        return apartments;\n    }\n\n    applyIntelligentFiltering(apartments, filteredResults) {\n        const relevanceMap = new Map();\n        filteredResults.forEach(result => {\n            relevanceMap.set(result.id, {\n                relevance: result.relevance_score,\n                reason: result.reason\n            });\n        });\n\n        return apartments\n            .map(apartment => {\n                const relevanceData = relevanceMap.get(apartment.id);\n                if (relevanceData) {\n                    return {\n                        ...apartment,\n                        aiRelevance: relevanceData.relevance,\n                        aiReason: relevanceData.reason\n                    };\n                }\n                return apartment;\n            })\n            .filter(apartment => apartment.aiRelevance !== undefined)\n            .sort((a, b) => (b.aiRelevance || 0) - (a.aiRelevance || 0));\n    }\n\n    // Generate personalized recommendations\n    async generateRecommendations(apartments, userPreferences = {}) {\n        if (!this.apiKey) {\n            return this.generateMockRecommendations(apartments);\n        }\n\n        try {\n            const prompt = `\nAs a real estate expert, provide personalized apartment recommendations based on user preferences and available listings.\n\nUser Preferences:\n${JSON.stringify(userPreferences, null, 2)}\n\nAvailable Apartments (top 10 by score):\n${JSON.stringify(apartments.slice(0, 10).map(apt => ({\n    title: apt.title,\n    address: apt.address,\n    price: apt.price,\n    features: apt.features,\n    score: apt.score,\n    zipCode: apt.zipCode\n})), null, 2)}\n\nProvide:\n1. Top 3 recommendations with detailed reasoning\n2. Alternative options to consider\n3. What to negotiate on\n4. Potential concerns to investigate\n\nRespond in JSON format with actionable recommendations.\n            `;\n\n            const response = await this.callClaudeAPI(prompt);\n            return response;\n        } catch (error) {\n            console.error('Error generating recommendations:', error);\n            return this.generateMockRecommendations(apartments);\n        }\n    }\n\n    generateMockRecommendations(apartments) {\n        const topApartments = apartments.slice(0, 3);\n        \n        return {\n            recommendations: topApartments.map((apt, index) => ({\n                apartment_id: apt.id,\n                ranking: index + 1,\n                reason: `High score of ${apt.score} with excellent ${apt.features.slice(0, 2).join(' and ')}`,\n                strengths: apt.features.slice(0, 3),\n                concerns: ['Verify parking availability', 'Check actual condition']\n            })),\n            market_insights: {\n                avg_price: Math.round(apartments.reduce((sum, apt) => sum + apt.price, 0) / apartments.length),\n                best_value: apartments.find(apt => apt.score > 70 && apt.price < 4700)?.id || null,\n                negotiation_tip: 'Focus on move-in incentives rather than base rent'\n            }\n        };\n    }\n\n    // Utility method to check API status\n    async testAPIConnection() {\n        if (!this.apiKey) {\n            return { success: false, error: 'No API key configured' };\n        }\n\n        try {\n            const response = await this.callClaudeAPI('Test connection. Respond with: {\"status\": \"connected\"}');\n            return { success: true, response };\n        } catch (error) {\n            return { success: false, error: error.message };\n        }\n    }\n}\n\n// Export for use in other modules\nexport const claudeAI = new ClaudeIntegration();"],"names":["ApartmentSearchEngine","constructor","this","searchCriteria","minRent","maxRent","bedrooms","minBathrooms","maxBathrooms","zipCodes","zipCodePriority","requiredAmenities","preferredFeatures","dataSources","name","priority","active","searchApartments","progressCallback","allApartments","totalSteps","length","i","zipCode","apartments","searchZipCode","push","delay","error","console","concat","validApartments","filter","validateApartment","apt","removeDuplicates","log","generateMockApartments","apartmentCount","Math","floor","random","areaData","areaName","basePrice","priceVariance","neighborhoods","streetNames","buildingTypes","amenityPool","buildingNumber","streetName","buildingType","priceOffset","price","round","finalPrice","max","min","selectedAmenities","selectRandomAmenities","sqft","bathrooms","renovationChance","recentlyRenovated","daysAgo","datePosted","Date","now","apartment","id","title","address","features","highlightFeatures","getHighlightFeatures","premiumAmenities","includes","toISOString","source","getRandomSource","url","generateListingUrl","contact","phone","generatePhoneNumber","email","toLowerCase","replace","images","generateMockImages","description","generateDescription","score","pool","count","sort","slice","highlights","highlightMap","forEach","feature","sources","areaCode","exchange","number","baseUrl","template","_building","area","zip","minPrice","maxPrice","cityState","citySlug","randomSource","urlPath","imageCount","amenities","descriptions","baseDescription","amenityText","join","seen","Set","key","has","add","ms","Promise","resolve","setTimeout","criteria","map","f","hasWasherDryer","some","hasAC","hasOutdoor","aboveGround","ApartmentScoring","weights","rentInRange","mandatoryAmenities","renovationRecency","naturalLight","outdoorSpaceQuality","locationRating","professionalPhotos","floorLevel","maxScore","calculateScore","totalScore","calculateRentScore","calculateMandatoryAmenityScore","calculateRenovationScore","calculateNaturalLightScore","calculateOutdoorSpaceScore","calculateZipCodeScore","calculatePremiumAmenitiesScore","calculateLocationRatingScore","calculatePhotoScore","calculateFloorScore","getScoreBreakdown","breakdown","specs","renovation","total","optimalRent","maxDeviation","deviation","abs","washerDryer","airConditioning","outdoorSpace","aboveGroundFloor","completionRate","Object","values","Boolean","keys","renovationKeywords","hasRenovationKeywords","keyword","explicitlyRenovated","modernAmenities","hasModernAmenities","amenity","_a","lightKeywords","lightIndicators","text","floorBonus","outdoorSpaceTypes","terrace","deck","balcony","patio","outdoor","spaceType","multiplier","entries","scoreMultiplier","premiumCount","baseRating","priceBonus","finalRating","modal","toastContainer","init","document","getElementById","bindGlobalEvents","addEventListener","e","classList","contains","closeModal","ctrlKey","preventDefault","searchBtn","style","display","focus","window","debounce","adjustLayoutForViewport","throttle","handleScroll","showModal","content","modalTitle","querySelector","modalBody","textContent","innerHTML","trapFocus","body","overflow","remove","showToast","message","type","duration","actions","toast","createElement","className","iconMap","success","warning","info","icon","actionsHTML","action","label","removeToast","querySelectorAll","btn","actionId","target","dataset","find","a","callback","appendChild","parentNode","removeChild","showLoadingSpinner","element","spinner","position","hideLoadingSpinner","viewport","getViewportSize","resultsGrid","width","gridTemplateColumns","modalContent","margin","maxHeight","innerWidth","height","innerHeight","scrollY","header","toggleBackToTop","show","backToTopBtn","scrollTo","top","behavior","focusableElements","firstFocusable","lastFocusable","shiftKey","activeElement","fadeIn","opacity","start","animate","timestamp","progress","requestAnimationFrame","fadeOut","slideDown","targetHeight","scrollHeight","slideUp","startHeight","offsetHeight","func","wait","timeout","args","clearTimeout","limit","inThrottle","apply","formatPrice","Intl","NumberFormat","currency","minimumFractionDigits","maximumFractionDigits","format","formatDate","date","DateTimeFormat","year","month","day","formatPhoneNumber","match","isValidEmail","test","isValidPhone","saveToStorage","data","localStorage","setItem","JSON","stringify","loadFromStorage","defaultValue","getItem","parse","removeFromStorage","removeItem","lazyLoader","options","rootMargin","threshold","placeholderSrc","errorSrc","fadeInDuration","retryAttempts","retryDelay","observer","loadedImages","failedImages","retryCount","Map","IntersectionObserver","entry","isIntersecting","loadImage","observeImages","loadAllImages","img","setupImageForLazyLoading","observe","src","addLoadingIndicator","transition","container","parentElement","wrapper","insertBefore","indicator","getAttribute","unobserve","preloadImage","removeAttribute","removeLoadingIndicator","dispatchEvent","CustomEvent","detail","warn","handleImageError","reject","Image","onload","onerror","Error","originalSrc","retryKey","currentRetries","get","set","retryError","refresh","Array","isArray","tagName","hasAttribute","loadImagesInContainer","getStats","loaded","size","failed","pending","destroy","disconnect","clear","readyState","ApartmentFinderApp","filteredApartments","bookmarkedApartments","isSearching","bindEvents","loadBookmarks","startSearch","applyFilters","value","toggleFilters","filterContent","isExpanded","exportResults","showLoadingState","searchEngine","scorer","updateProgress","scoreBreakdown","showResults","hideLoadingState","loadingIndicator","currentStep","stepId","index","filtered","minScore","parseInt","checked","weekAgo","sortBy","b","renderResults","scrollIntoView","recentResults","recentListings","noResults","recentApartments","createApartmentCard","card","apartmentId","showApartmentDetails","isRecent","scoreClass","bookmarked","toLocaleString","bookmarkBtn","imageGallery","_b","toLocaleDateString","isBookmarked","onclick","toggleBookmark","indexOf","splice","exportData","csv","convertToCSV","downloadCSV","row","filename","blob","Blob","URL","createObjectURL","setAttribute","click","revokeObjectURL","apiKey","baseURL","model","maxTokens","showAPIKeySetup","setupPanel","trim","setAPIKey","enhanceApartmentDescriptions","prompt","buildDescriptionEnhancementPrompt","response","callClaudeAPI","enhanced_descriptions","applyEnhancedDescriptions","generateSearchInsights","buildInsightsPrompt","apartmentSummaries","topApartments","avgPrice","reduce","sum","scoreDistribution","high","medium","low","fetch","method","headers","max_tokens","messages","role","ok","status","statusText","json","parseError","enhancedDescriptions","enhancedMap","item","enhanced_description","enhanced","intelligentFilter","userQuery","filtered_apartments","applyIntelligentFiltering","filteredResults","relevanceMap","result","relevance","relevance_score","reason","relevanceData","aiRelevance","aiReason","generateRecommendations","userPreferences","generateMockRecommendations","recommendations","apartment_id","ranking","strengths","concerns","market_insights","avg_price","best_value","negotiation_tip","testAPIConnection"],"mappings":"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"}
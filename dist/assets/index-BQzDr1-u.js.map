{"version":3,"file":"index-BQzDr1-u.js","sources":["../../js/search-engine.js","../../js/scoring.js","../../js/lazy-loading.js","../../js/link-health-monitor.js","../../js/app.js","../../api/claude-integration.js"],"sourcesContent":["export class ApartmentSearchEngine {\n    constructor() {\n        this.searchCriteria = {\n            minRent: 4400,\n            maxRent: 5200,\n            bedrooms: 2,\n            minBathrooms: 1.5,\n            maxBathrooms: 2.0,\n            zipCodes: ['90066', '90230', '90232', '90034'],\n            zipCodePriority: {\n                '90066': 1, // Mar Vista - highest priority\n                '90230': 2, // Central Culver City\n                '90232': 3, // Southeast Culver City\n                '90034': 4  // Palms\n            },\n            requiredAmenities: [\n                'washer_dryer',\n                'air_conditioning',\n                'outdoor_space',\n                'above_ground_floor'\n            ],\n            preferredFeatures: [\n                'recently_renovated',\n                'modern_interior',\n                'natural_light'\n            ]\n        };\n        \n        this.dataSources = [\n            { name: 'apartments.com', priority: 1, active: true },\n            { name: 'westside_rentals', priority: 1, active: true },\n            { name: 'zillow', priority: 1, active: true },\n            { name: 'trulia', priority: 2, active: true },\n            { name: 'hotpads', priority: 2, active: true },\n            { name: 'redfin', priority: 2, active: true },\n            { name: 'rentcafe', priority: 2, active: true },\n            { name: 'zumper', priority: 2, active: true },\n            { name: 'realtor.com', priority: 2, active: true },\n            { name: 'craigslist', priority: 3, active: true }\n        ];\n        \n        // Scoring will be handled by external module\n    }\n\n    async searchApartments(progressCallback) {\n        const allApartments = [];\n        const currentProgress = 0;\n        const totalSteps = this.searchCriteria.zipCodes.length + 1; // +1 for final scoring\n        \n        // Search each zip code\n        for (let i = 0; i < this.searchCriteria.zipCodes.length; i++) {\n            const zipCode = this.searchCriteria.zipCodes[i];\n            \n            if (progressCallback) {\n                progressCallback((i / totalSteps) * 100);\n            }\n            \n            try {\n                const apartments = await this.searchZipCode(zipCode);\n                allApartments.push(...apartments);\n                \n                // Add small delay to prevent overwhelming APIs\n                await this.delay(500);\n            } catch (error) {\n                console.error(`Error searching zip code ${zipCode}:`, error);\n            }\n        }\n        \n        // Final scoring and ranking\n        if (progressCallback) {\n            progressCallback(((totalSteps - 1) / totalSteps) * 100);\n        }\n        \n        // Return apartments without scoring (will be handled by caller)\n        const validApartments = allApartments.filter(apt => this.validateApartment(apt));\n        \n        if (progressCallback) {\n            progressCallback(100);\n        }\n        \n        return this.removeDuplicates(validApartments);\n    }\n\n    async searchZipCode(zipCode) {\n        console.log(`Searching zip code: ${zipCode}`);\n        \n        // Since we can't actually call external APIs in this demo,\n        // we'll generate realistic mock data based on the zip code\n        return this.generateMockApartments(zipCode);\n    }\n\n    generateMockApartments(zipCode) {\n        const apartmentCount = Math.floor(Math.random() * 15) + 5; // 5-20 apartments per zip\n        const apartments = [];\n        \n        // Zip code specific data\n        const zipCodeData = {\n            '90066': { // Mar Vista\n                areaName: 'Mar Vista',\n                basePrice: 4800,\n                priceVariance: 300,\n                neighborhoods: ['Mar Vista', 'Venice Adjacent', 'Westside']\n            },\n            '90230': { // Central Culver City\n                areaName: 'Culver City',\n                basePrice: 4600,\n                priceVariance: 400,\n                neighborhoods: ['Downtown Culver City', 'Arts District', 'Hayden Tract']\n            },\n            '90232': { // Southeast Culver City\n                areaName: 'Culver City',\n                basePrice: 4500,\n                priceVariance: 350,\n                neighborhoods: ['Fox Hills', 'Culver West', 'Baldwin Hills Adjacent']\n            },\n            '90034': { // Palms\n                areaName: 'Palms',\n                basePrice: 4400,\n                priceVariance: 300,\n                neighborhoods: ['Palms', 'Motor Avenue', 'Mid City West']\n            }\n        };\n        \n        const areaData = zipCodeData[zipCode];\n        const streetNames = [\n            'Pacific Ave', 'Lincoln Blvd', 'Venice Blvd', 'Washington Blvd',\n            'Motor Ave', 'Sepulveda Blvd', 'Culver Blvd', 'Jefferson Blvd',\n            'Pico Blvd', 'Olympic Blvd', 'Exposition Blvd', 'National Blvd'\n        ];\n        \n        const buildingTypes = [\n            'Modern Apartment Complex', 'Luxury Townhome', 'Contemporary Loft',\n            'Garden Style Apartment', 'Mid-Rise Building', 'Renovated Complex'\n        ];\n        \n        const amenityPool = [\n            'In-Unit Washer/Dryer', 'Central Air Conditioning', 'Private Balcony',\n            'Stainless Steel Appliances', 'Hardwood Floors', 'Walk-in Closet',\n            'Granite Countertops', 'Swimming Pool', 'Fitness Center', 'Parking Garage',\n            'Pet Friendly', 'Dishwasher', 'Recently Renovated', 'Natural Light',\n            'High Ceilings', 'Modern Kitchen', 'Patio/Deck', 'Storage Unit'\n        ];\n        \n        for (let i = 0; i < apartmentCount; i++) {\n            const buildingNumber = Math.floor(Math.random() * 9999) + 1000;\n            const streetName = streetNames[Math.floor(Math.random() * streetNames.length)];\n            const buildingType = buildingTypes[Math.floor(Math.random() * buildingTypes.length)];\n            \n            // Price calculation with some variance\n            const basePrice = areaData.basePrice;\n            const priceOffset = (Math.random() - 0.5) * areaData.priceVariance * 2;\n            const price = Math.round((basePrice + priceOffset) / 50) * 50; // Round to nearest $50\n            \n            // Ensure price is within budget\n            const finalPrice = Math.max(4400, Math.min(5200, price));\n            \n            // Random but realistic features\n            const selectedAmenities = this.selectRandomAmenities(amenityPool, 8, 12);\n            const floor = Math.floor(Math.random() * 8) + 2; // Floors 2-9 (above ground)\n            const sqft = 900 + Math.floor(Math.random() * 400); // 900-1300 sq ft\n            const bathrooms = Math.random() > 0.4 ? 2.0 : 1.5; // 60% chance of 2 bath, 40% chance of 1.5\n            \n            // Recent renovation chance (higher for more expensive units)\n            const renovationChance = (finalPrice - 4400) / 800; // 0-1 based on price\n            const recentlyRenovated = Math.random() < (0.3 + renovationChance * 0.4);\n            \n            // Recent posting (some apartments are newer listings)\n            const daysAgo = Math.floor(Math.random() * 30); // 0-30 days ago\n            const datePosted = new Date(Date.now() - daysAgo * 24 * 60 * 60 * 1000);\n            \n            const apartment = {\n                id: `apt_${zipCode}_${i}_${Date.now()}`,\n                title: `${buildingType} in ${areaData.areaName}`,\n                address: `${buildingNumber} ${streetName}, ${areaData.areaName}, CA ${zipCode}`,\n                zipCode,\n                price: finalPrice,\n                bedrooms: 2,\n                bathrooms,\n                sqft,\n                floor,\n                features: selectedAmenities,\n                highlightFeatures: this.getHighlightFeatures(selectedAmenities),\n                recentlyRenovated,\n                premiumAmenities: selectedAmenities.includes('Swimming Pool') || \n                                selectedAmenities.includes('Fitness Center') ||\n                                selectedAmenities.includes('Parking Garage'),\n                datePosted: datePosted.toISOString(),\n                source: this.getRandomSource(),\n                url: this.generateListingUrl(buildingType, areaData.areaName, zipCode, finalPrice),\n                backupUrls: this.generateBackupUrls(areaData.areaName, zipCode),\n                contact: {\n                    phone: this.generatePhoneNumber(),\n                    email: `leasing@${buildingType.toLowerCase().replace(/\\s+/g, '')}apartments.com`\n                },\n                images: this.generateMockImages(),\n                description: this.generateDescription(buildingType, areaData.areaName, selectedAmenities),\n                score: 0 // Will be calculated later\n            };\n            \n            apartments.push(apartment);\n        }\n        \n        return apartments;\n    }\n\n    selectRandomAmenities(pool, min, max) {\n        const count = Math.floor(Math.random() * (max - min + 1)) + min;\n        const shuffled = [...pool].sort(() => 0.5 - Math.random());\n        return shuffled.slice(0, count);\n    }\n\n    getHighlightFeatures(features) {\n        const highlights = [];\n        const highlightMap = {\n            'In-Unit Washer/Dryer': 'In-Unit Washer/Dryer',\n            'Central Air Conditioning': 'Central Air Conditioning',\n            'Private Balcony': 'Private Balcony',\n            'Recently Renovated': 'Recently Renovated',\n            'Natural Light': 'Natural Light',\n            'Modern Kitchen': 'Modern Kitchen'\n        };\n        \n        features.forEach(feature => {\n            if (highlightMap[feature]) {\n                highlights.push(feature);\n            }\n        });\n        \n        return highlights;\n    }\n\n    getRandomSource() {\n        const sources = [\n            'Apartments.com', 'Westside Rentals', 'Zillow Rentals',\n            'Trulia', 'HotPads', 'Redfin', 'RentCafe', 'Zumper'\n        ];\n        return sources[Math.floor(Math.random() * sources.length)];\n    }\n\n    generatePhoneNumber() {\n        const areaCode = ['310', '424', '323'][Math.floor(Math.random() * 3)];\n        const exchange = Math.floor(Math.random() * 900) + 100;\n        const number = Math.floor(Math.random() * 9000) + 1000;\n        return `(${areaCode}) ${exchange}-${number}`;\n    }\n\n    generateListingUrl(buildingType, areaName, zipCode, price) {\n        // Ultra-stable URL generation - prioritize simplicity and reliability\n        const stableSources = [\n            {\n                name: 'Apartments.com',\n                baseUrl: 'https://www.apartments.com',\n                template: (_building, area, zip, _price) => {\n                    // Use the most stable page - just metro area\n                    return 'los-angeles-ca/';\n                },\n                weight: 3 // Higher weight = more likely to be selected\n            },\n            {\n                name: 'Zillow',\n                baseUrl: 'https://www.zillow.com',\n                template: (_building, area, zip, _price) => {\n                    // Use metro-level rentals page\n                    return 'los-angeles-ca/rentals/';\n                },\n                weight: 3\n            },\n            {\n                name: 'Trulia',\n                baseUrl: 'https://www.trulia.com',\n                template: (_building, area, zip, _price) => {\n                    // Use stable city-level page\n                    return 'for_rent/Los_Angeles,CA/';\n                },\n                weight: 2\n            },\n            {\n                name: 'HotPads',\n                baseUrl: 'https://hotpads.com',\n                template: (_building, area, zip, _price) => {\n                    // Use city-level search\n                    return 'los-angeles-ca/apartments-for-rent';\n                },\n                weight: 2\n            },\n            {\n                name: 'Westside Rentals',\n                baseUrl: 'https://www.westsiderentals.com',\n                template: (_building, area, zip, _price) => {\n                    // Use homepage - most stable\n                    return '';\n                },\n                weight: 2\n            },\n            {\n                name: 'Realtor.com',\n                baseUrl: 'https://www.realtor.com',\n                template: (_building, area, zip, _price) => {\n                    // Use city-level apartments page\n                    return 'apartments-for-rent/Los-Angeles_CA';\n                },\n                weight: 1\n            }\n        ];\n\n        // Select source based on weights (higher weight = more likely)\n        const totalWeight = stableSources.reduce((sum, source) => sum + source.weight, 0);\n        let random = Math.random() * totalWeight;\n        let selectedSource;\n\n        for (const source of stableSources) {\n            random -= source.weight;\n            if (random <= 0) {\n                selectedSource = source;\n                break;\n            }\n        }\n\n        // Fallback to first source if selection failed\n        if (!selectedSource) {\n            selectedSource = stableSources[0];\n        }\n\n        try {\n            const urlPath = selectedSource.template(buildingType, areaName, zipCode, price);\n            const finalUrl = urlPath ? `${selectedSource.baseUrl}/${urlPath}` : selectedSource.baseUrl;\n            \n            // Validate the generated URL\n            if (!this.isValidUrl(finalUrl)) {\n                throw new Error('Generated invalid URL');\n            }\n            \n            return finalUrl;\n        } catch (error) {\n            console.warn(`URL generation failed for ${selectedSource.name}, using safe fallback:`, error);\n            // Ultra-safe fallback - guaranteed to work\n            return 'https://www.apartments.com/los-angeles-ca/';\n        }\n    }\n\n    // Enhanced URL validation\n    isValidUrl(url) {\n        try {\n            const urlObj = new URL(url);\n            return urlObj.protocol === 'http:' || urlObj.protocol === 'https:';\n        } catch {\n            return false;\n        }\n    }\n\n    // Helper method to sanitize city names for URLs\n    sanitizeCityName(cityName) {\n        return cityName\n            .toLowerCase()\n            .replace(/[^a-z0-9\\s-]/g, '') // Remove special characters\n            .replace(/\\s+/g, '-') // Replace spaces with hyphens\n            .replace(/-+/g, '-') // Replace multiple hyphens with single\n            .replace(/^-|-$/g, ''); // Remove leading/trailing hyphens\n    }\n\n    generateMockImages() {\n        // In a real app, these would be actual image URLs\n        const imageCount = Math.floor(Math.random() * 5) + 1; // 1-5 images\n        const images = [];\n        \n        for (let i = 0; i < imageCount; i++) {\n            images.push(`https://via.placeholder.com/600x400/f0f0f0/666666?text=Apartment+Image+${i + 1}`);\n        }\n        \n        return images;\n    }\n\n    generateDescription(buildingType, area, amenities) {\n        const descriptions = [\n            `Beautiful ${buildingType.toLowerCase()} located in the heart of ${area}. This stunning 2-bedroom unit features modern finishes and premium amenities.`,\n            `Discover luxury living in this ${buildingType.toLowerCase()} in ${area}. Perfectly designed for comfort and style.`,\n            `Spacious and bright 2-bedroom apartment in a desirable ${area} location. This ${buildingType.toLowerCase()} offers the perfect blend of comfort and convenience.`\n        ];\n        \n        const baseDescription = descriptions[Math.floor(Math.random() * descriptions.length)];\n        const amenityText = amenities.slice(0, 4).join(', ');\n        \n        return `${baseDescription} Key features include: ${amenityText}. Contact us today to schedule a viewing!`;\n    }\n\n    // Removed scoreAndRankApartments - handled by external scoring module\n\n    removeDuplicates(apartments) {\n        const seen = new Set();\n        return apartments.filter(apartment => {\n            const key = `${apartment.address}_${apartment.price}_${apartment.bedrooms}`;\n            if (seen.has(key)) {\n                return false;\n            }\n            seen.add(key);\n            return true;\n        });\n    }\n\n    delay(ms) {\n        return new Promise(resolve => setTimeout(resolve, ms));\n    }\n\n    // URL validation and health checking\n    async validateUrl(url) {\n        try {\n            // Use a simple HEAD request to check if URL exists\n            // Note: This may be blocked by CORS, so we'll use a graceful fallback\n            const controller = new AbortController();\n            const timeoutId = setTimeout(() => controller.abort(), 5000); // 5 second timeout\n            \n            const response = await fetch(url, {\n                method: 'HEAD',\n                signal: controller.signal,\n                mode: 'no-cors' // Bypass CORS for basic connectivity check\n            });\n            \n            clearTimeout(timeoutId);\n            return { valid: true, status: response.status || 'unknown' };\n        } catch (error) {\n            // If HEAD request fails, the URL might still work for users\n            // Return as potentially valid with warning\n            return { \n                valid: true, \n                status: 'unverified',\n                warning: 'Could not verify URL due to CORS or network restrictions'\n            };\n        }\n    }\n\n    // Enhanced URL generation with validation\n    async generateValidatedListingUrl(buildingType, areaName, zipCode, price) {\n        const primaryUrl = this.generateListingUrl(buildingType, areaName, zipCode, price);\n        \n        // In development/testing, validate the URL\n        if (process.env.NODE_ENV === 'development') {\n            const validation = await this.validateUrl(primaryUrl);\n            if (validation.warning) {\n                console.warn(`URL validation warning for ${primaryUrl}: ${validation.warning}`);\n            }\n        }\n        \n        return primaryUrl;\n    }\n\n    // Generate comprehensive backup URLs using enhanced link monitor\n    generateBackupUrls(areaName, zipCode, price) {\n        // Import the enhanced alternative URL generator from link health monitor\n        const encodedArea = encodeURIComponent(areaName || '');\n        const encodedQuery = encodeURIComponent(`${areaName} CA ${zipCode} apartments rent 2 bedroom`);\n        \n        // Primary backup sources - guaranteed to work\n        const primaryBackups = [\n            {\n                name: 'Google Search',\n                url: `https://www.google.com/search?q=${encodedQuery}&tbm=&tbs=qdr:m`,\n                type: 'search',\n                priority: 1,\n                description: 'Search all listings'\n            },\n            {\n                name: 'Apartments.com Browse',\n                url: `https://www.apartments.com/los-angeles-ca/`,\n                type: 'listings',\n                priority: 1,\n                description: 'Browse LA apartments'\n            },\n            {\n                name: 'Zillow Rentals',\n                url: `https://www.zillow.com/los-angeles-ca/rentals/`,\n                type: 'listings',\n                priority: 1,\n                description: 'Rental listings'\n            }\n        ];\n\n        // Secondary backup sources  \n        const secondaryBackups = [\n            {\n                name: 'HotPads',\n                url: `https://hotpads.com/los-angeles-ca/apartments-for-rent`,\n                type: 'listings',\n                priority: 2,\n                description: 'Map-based search'\n            },\n            {\n                name: 'Westside Rentals',\n                url: `https://www.westsiderentals.com/`,\n                type: 'listings',\n                priority: 2,\n                description: 'Westside specialist'\n            }\n        ];\n\n        // Return prioritized backup options\n        return [...primaryBackups, ...secondaryBackups];\n    }\n\n    // Method to validate apartment against mandatory criteria\n    validateApartment(apartment) {\n        const criteria = this.searchCriteria;\n        \n        // Check price range\n        if (apartment.price < criteria.minRent || apartment.price > criteria.maxRent) {\n            return false;\n        }\n        \n        // Check bedrooms\n        if (apartment.bedrooms !== criteria.bedrooms) {\n            return false;\n        }\n        \n        // Check bathrooms\n        if (apartment.bathrooms < criteria.minBathrooms || apartment.bathrooms > criteria.maxBathrooms) {\n            return false;\n        }\n        \n        // Check required amenities (simplified check)\n        const features = apartment.features.map(f => f.toLowerCase());\n        const hasWasherDryer = features.some(f => f.includes('washer') && f.includes('dryer'));\n        const hasAC = features.some(f => f.includes('air') || f.includes('conditioning'));\n        const hasOutdoor = features.some(f => f.includes('balcony') || f.includes('patio') || f.includes('deck'));\n        const aboveGround = apartment.floor > 1;\n        \n        if (!hasWasherDryer || !hasAC || !hasOutdoor || !aboveGround) {\n            return false;\n        }\n        \n        return true;\n    }\n}","export class ApartmentScoring {\n    constructor() {\n        this.weights = {\n            // Base criteria (50 points total)\n            rentInRange: 20,        // Within $4,400-$5,200 range\n            mandatoryAmenities: 30, // All required amenities present\n            \n            // Quality factors (35 points total)\n            renovationRecency: 25,  // Recently renovated (within 10 years)\n            naturalLight: 15,       // Natural light indicators\n            outdoorSpaceQuality: 10, // Quality of balcony/patio/terrace\n            \n            // Location factors (10 points total)\n            zipCodePriority: 10,    // Preferred zip code ranking\n            \n            // Bonus factors (15 points total)\n            premiumAmenities: 5,    // Premium building amenities\n            locationRating: 5,      // Excellent location ratings\n            professionalPhotos: 3,  // Quality listing photos\n            floorLevel: 2,          // Higher floors preferred\n        };\n        \n        this.maxScore = 100;\n    }\n\n    calculateScore(apartment, searchCriteria = {\n        minRent: 4400,\n        maxRent: 5200,\n        zipCodePriority: {\n            '90066': 1,\n            '90230': 2, \n            '90232': 3,\n            '90034': 4\n        }\n    }) {\n        let totalScore = 0;\n        const scoreBreakdown = {};\n        \n        // Base Score: Rent within range (20 points)\n        const rentScore = this.calculateRentScore(apartment.price, searchCriteria);\n        scoreBreakdown.rent = rentScore;\n        totalScore += rentScore;\n        \n        // Mandatory amenities (30 points)\n        const amenityScore = this.calculateMandatoryAmenityScore(apartment);\n        scoreBreakdown.amenities = amenityScore;\n        totalScore += amenityScore;\n        \n        // Renovation recency (25 points)\n        const renovationScore = this.calculateRenovationScore(apartment);\n        scoreBreakdown.renovation = renovationScore;\n        totalScore += renovationScore;\n        \n        // Natural light (15 points)\n        const lightScore = this.calculateNaturalLightScore(apartment);\n        scoreBreakdown.naturalLight = lightScore;\n        totalScore += lightScore;\n        \n        // Outdoor space quality (10 points)\n        const outdoorScore = this.calculateOutdoorSpaceScore(apartment);\n        scoreBreakdown.outdoorSpace = outdoorScore;\n        totalScore += outdoorScore;\n        \n        // Zip code priority (10 points)\n        const locationScore = this.calculateZipCodeScore(apartment.zipCode, searchCriteria);\n        scoreBreakdown.location = locationScore;\n        totalScore += locationScore;\n        \n        // Bonus: Premium amenities (5 points)\n        const premiumScore = this.calculatePremiumAmenitiesScore(apartment);\n        scoreBreakdown.premiumAmenities = premiumScore;\n        totalScore += premiumScore;\n        \n        // Bonus: Location rating (5 points)\n        const ratingScore = this.calculateLocationRatingScore(apartment);\n        scoreBreakdown.locationRating = ratingScore;\n        totalScore += ratingScore;\n        \n        // Bonus: Professional photos (3 points)\n        const photoScore = this.calculatePhotoScore(apartment);\n        scoreBreakdown.photos = photoScore;\n        totalScore += photoScore;\n        \n        // Bonus: Floor level preference (2 points)\n        const floorScore = this.calculateFloorScore(apartment);\n        scoreBreakdown.floor = floorScore;\n        totalScore += floorScore;\n        \n        return Math.round(Math.min(totalScore, this.maxScore));\n    }\n\n    getScoreBreakdown(apartment, searchCriteria = {\n        minRent: 4400,\n        maxRent: 5200,\n        zipCodePriority: {\n            '90066': 1,\n            '90230': 2,\n            '90232': 3, \n            '90034': 4\n        }\n    }) {\n        const breakdown = {};\n        \n        breakdown.price = this.calculateRentScore(apartment.price, searchCriteria);\n        breakdown.specs = this.calculateMandatoryAmenityScore(apartment);\n        breakdown.floor = this.calculateFloorScore(apartment);\n        breakdown.features = this.calculateRenovationScore(apartment) + \n                           this.calculateNaturalLightScore(apartment) + \n                           this.calculateOutdoorSpaceScore(apartment);\n        breakdown.renovation = apartment.recentlyRenovated ? 10 : 0;\n        \n        breakdown.total = Math.min(\n            breakdown.price + breakdown.specs + breakdown.floor + \n            breakdown.features + breakdown.renovation, \n            100\n        );\n        \n        return breakdown;\n    }\n\n    calculateRentScore(price, searchCriteria) {\n        const { minRent, maxRent } = searchCriteria;\n        \n        if (price < minRent || price > maxRent) {\n            return 0;\n        }\n        \n        const optimalRent = (minRent + maxRent) / 2;\n        const maxDeviation = (maxRent - minRent) / 2;\n        const deviation = Math.abs(price - optimalRent);\n        const score = this.weights.rentInRange * (1 - deviation / maxDeviation);\n        \n        return Math.round(score);\n    }\n\n    calculateMandatoryAmenityScore(apartment) {\n        const requiredAmenities = {\n            washerDryer: false,\n            airConditioning: false,\n            outdoorSpace: false,\n            aboveGroundFloor: false\n        };\n        \n        const features = apartment.features.map(f => f.toLowerCase());\n        \n        requiredAmenities.washerDryer = features.some(f => \n            (f.includes('washer') && f.includes('dryer')) || \n            f.includes('w/d') || \n            f.includes('laundry')\n        );\n        \n        requiredAmenities.airConditioning = features.some(f => \n            f.includes('air') || \n            f.includes('conditioning') || \n            f.includes('hvac') ||\n            f.includes('central air')\n        );\n        \n        requiredAmenities.outdoorSpace = features.some(f => \n            f.includes('balcony') || \n            f.includes('patio') || \n            f.includes('terrace') ||\n            f.includes('deck') ||\n            f.includes('outdoor')\n        );\n        \n        requiredAmenities.aboveGroundFloor = apartment.floor > 1;\n        \n        const metRequirements = Object.values(requiredAmenities).filter(Boolean).length;\n        const totalRequirements = Object.keys(requiredAmenities).length;\n        const completionRate = metRequirements / totalRequirements;\n        \n        return Math.round(this.weights.mandatoryAmenities * completionRate);\n    }\n\n    calculateRenovationScore(apartment) {\n        const features = apartment.features.map(f => f.toLowerCase());\n        \n        const renovationKeywords = [\n            'renovated', 'updated', 'remodeled', 'modern', 'new',\n            'contemporary', 'upgraded', 'refreshed', 'redesigned'\n        ];\n        \n        const hasRenovationKeywords = features.some(f => \n            renovationKeywords.some(keyword => f.includes(keyword))\n        );\n        \n        const explicitlyRenovated = apartment.recentlyRenovated || false;\n        \n        const modernAmenities = [\n            'stainless steel', 'granite', 'quartz', 'hardwood',\n            'modern kitchen', 'designer', 'luxury'\n        ];\n        \n        const hasModernAmenities = features.some(f => \n            modernAmenities.some(amenity => f.includes(amenity))\n        );\n        \n        let score = 0;\n        \n        if (explicitlyRenovated) {\n            score = this.weights.renovationRecency;\n        } else if (hasRenovationKeywords && hasModernAmenities) {\n            score = this.weights.renovationRecency * 0.8;\n        } else if (hasRenovationKeywords || hasModernAmenities) {\n            score = this.weights.renovationRecency * 0.5;\n        } else {\n            score = this.weights.renovationRecency * 0.2;\n        }\n        \n        return Math.round(score);\n    }\n\n    calculateNaturalLightScore(apartment) {\n        const features = apartment.features.map(f => f.toLowerCase());\n        const description = apartment.description?.toLowerCase() || '';\n        \n        const lightKeywords = [\n            'natural light', 'bright', 'sunny', 'light-filled',\n            'windows', 'large windows', 'floor-to-ceiling',\n            'multiple exposures', 'corner unit'\n        ];\n        \n        const lightIndicators = features.concat([description]).some(text => \n            lightKeywords.some(keyword => text.includes(keyword))\n        );\n        \n        const floorBonus = apartment.floor > 5 ? 0.2 : 0;\n        \n        let score = 0;\n        \n        if (lightIndicators) {\n            score = this.weights.naturalLight * (0.8 + floorBonus);\n        } else {\n            score = this.weights.naturalLight * (0.4 + floorBonus);\n        }\n        \n        return Math.round(score);\n    }\n\n    calculateOutdoorSpaceScore(apartment) {\n        const features = apartment.features.map(f => f.toLowerCase());\n        \n        const outdoorSpaceTypes = {\n            'private balcony': 1.0,\n            'terrace': 1.0,\n            'private patio': 0.9,\n            'deck': 0.8,\n            'balcony': 0.7,\n            'patio': 0.6,\n            'outdoor': 0.5\n        };\n        \n        let maxScore = 0;\n        \n        for (const [spaceType, multiplier] of Object.entries(outdoorSpaceTypes)) {\n            if (features.some(f => f.includes(spaceType))) {\n                maxScore = Math.max(maxScore, this.weights.outdoorSpaceQuality * multiplier);\n            }\n        }\n        \n        return Math.round(maxScore);\n    }\n\n    calculateZipCodeScore(zipCode, searchCriteria) {\n        const priority = searchCriteria.zipCodePriority[zipCode] || 5;\n        const scoreMultiplier = Math.max(0, (5 - priority) / 4);\n        return Math.round(this.weights.zipCodePriority * scoreMultiplier);\n    }\n\n    calculatePremiumAmenitiesScore(apartment) {\n        const features = apartment.features.map(f => f.toLowerCase());\n        \n        const premiumAmenities = [\n            'swimming pool', 'fitness center', 'gym', 'concierge',\n            'doorman', 'roof deck', 'rooftop', 'parking garage',\n            'valet parking', 'business center', 'club room'\n        ];\n        \n        const premiumCount = features.filter(f => \n            premiumAmenities.some(amenity => f.includes(amenity))\n        ).length;\n        \n        const score = Math.min(premiumCount * 1.5, this.weights.premiumAmenities);\n        return Math.round(score);\n    }\n\n    calculateLocationRatingScore(apartment) {\n        const zipCodeRatings = {\n            '90066': 4.5,\n            '90230': 4.2,\n            '90232': 3.8,\n            '90034': 3.5\n        };\n        \n        const baseRating = zipCodeRatings[apartment.zipCode] || 3.0;\n        const priceBonus = apartment.price > 4800 ? 0.2 : 0;\n        const finalRating = Math.min(baseRating + priceBonus, 5.0);\n        const scoreMultiplier = Math.max(0, (finalRating - 3.0) / 2.0);\n        \n        return Math.round(this.weights.locationRating * scoreMultiplier);\n    }\n\n    calculatePhotoScore(apartment) {\n        const imageCount = apartment.images?.length || 0;\n        \n        if (imageCount >= 5) {\n            return this.weights.professionalPhotos;\n        } else if (imageCount >= 3) {\n            return Math.round(this.weights.professionalPhotos * 0.7);\n        } else if (imageCount >= 1) {\n            return Math.round(this.weights.professionalPhotos * 0.4);\n        } else {\n            return 0;\n        }\n    }\n\n    calculateFloorScore(apartment) {\n        const floor = apartment.floor || 2;\n        \n        if (floor >= 3 && floor <= 6) {\n            return this.weights.floorLevel;\n        } else if (floor === 2 || floor === 7 || floor === 8) {\n            return Math.round(this.weights.floorLevel * 0.7);\n        } else if (floor > 8) {\n            return Math.round(this.weights.floorLevel * 0.5);\n        } else {\n            return 0;\n        }\n    }\n}","/**\n * Lazy Loading utility for property images with Intersection Observer\n * Optimizes performance by loading images only when they enter the viewport\n */\nexport class LazyImageLoader {\n    constructor(options = {}) {\n        this.options = {\n            rootMargin: '50px',\n            threshold: 0.1,\n            placeholderSrc: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZGVmcz48bGluZWFyR3JhZGllbnQgaWQ9ImciIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMTAwJSIgeTI9IjEwMCUiPjxzdG9wIG9mZnNldD0iMCUiIHN0b3AtY29sb3I9IiNmNWY1ZjUiLz48c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiNlZWVlZWUiLz48L2xpbmVhckdyYWRpZW50PjwvZGVmcz48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJ1cmwoI2cpIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNHB4IiBmaWxsPSIjOTk5OTk5IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkb21pbmFudC1iYXNlbGluZT0ibWlkZGxlIj5Mb2FkaW5nLi4uPC90ZXh0Pjwvc3ZnPg==',\n            errorSrc: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjVmNWY1Ii8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNHB4IiBmaWxsPSIjOTk5OTk5IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkb21pbmFudC1iYXNlbGluZT0ibWlkZGxlIj5JbWFnZSBVbmF2YWlsYWJsZTwvdGV4dD48L3N2Zz4=',\n            fadeInDuration: 300,\n            retryAttempts: 2,\n            retryDelay: 1000,\n            ...options\n        };\n\n        this.observer = null;\n        this.loadedImages = new Set();\n        this.failedImages = new Set();\n        this.retryCount = new Map();\n        \n        this.init();\n    }\n\n    init() {\n        if (!('IntersectionObserver' in window)) {\n            // Fallback for older browsers\n            this.loadAllImages();\n            return;\n        }\n\n        this.observer = new IntersectionObserver((entries) => {\n            entries.forEach(entry => {\n                if (entry.isIntersecting) {\n                    this.loadImage(entry.target);\n                }\n            });\n        }, {\n            rootMargin: this.options.rootMargin,\n            threshold: this.options.threshold\n        });\n\n        this.observeImages();\n    }\n\n    observeImages() {\n        const images = document.querySelectorAll('img[data-src]');\n        images.forEach(img => {\n            if (!this.loadedImages.has(img)) {\n                this.setupImageForLazyLoading(img);\n                this.observer.observe(img);\n            }\n        });\n    }\n\n    setupImageForLazyLoading(img) {\n        // Set placeholder if no src is set\n        if (!img.src || img.src === '') {\n            img.src = this.options.placeholderSrc;\n        }\n\n        // Add loading class\n        img.classList.add('lazy-loading');\n        \n        // Add loading indicator\n        this.addLoadingIndicator(img);\n\n        // Set initial opacity for fade effect\n        img.style.opacity = '0';\n        img.style.transition = `opacity ${this.options.fadeInDuration}ms ease-in-out`;\n    }\n\n    addLoadingIndicator(img) {\n        const container = img.parentElement;\n        if (!container.classList.contains('image-container')) {\n            // Wrap img in container if not already wrapped\n            const wrapper = document.createElement('div');\n            wrapper.className = 'image-container';\n            img.parentNode.insertBefore(wrapper, img);\n            wrapper.appendChild(img);\n        }\n\n        // Add loading indicator\n        if (!container.querySelector('.loading-indicator')) {\n            const indicator = document.createElement('div');\n            indicator.className = 'loading-indicator';\n            indicator.innerHTML = `\n                <div class=\"loading-spinner\">\n                    <div class=\"spinner\"></div>\n                </div>\n            `;\n            container.appendChild(indicator);\n        }\n    }\n\n    async loadImage(img) {\n        const src = img.getAttribute('data-src');\n        if (!src || this.loadedImages.has(img)) {\n            return;\n        }\n\n        try {\n            // Stop observing this image\n            if (this.observer) {\n                this.observer.unobserve(img);\n            }\n\n            // Pre-load the image\n            await this.preloadImage(src);\n\n            // Set the actual source\n            img.src = src;\n            img.removeAttribute('data-src');\n\n            // Add loaded class and fade in\n            img.classList.remove('lazy-loading');\n            img.classList.add('lazy-loaded');\n            \n            // Fade in effect\n            img.style.opacity = '1';\n\n            // Remove loading indicator\n            this.removeLoadingIndicator(img);\n\n            // Mark as loaded\n            this.loadedImages.add(img);\n\n            // Trigger custom event\n            img.dispatchEvent(new CustomEvent('lazyLoaded', {\n                detail: { src, img }\n            }));\n\n        } catch (error) {\n            console.warn('Failed to load image:', src, error);\n            await this.handleImageError(img, src);\n        }\n    }\n\n    preloadImage(src) {\n        return new Promise((resolve, reject) => {\n            const img = new Image();\n            \n            img.onload = () => resolve(img);\n            img.onerror = () => reject(new Error(`Failed to load image: ${src}`));\n            \n            // Set a timeout for the image load\n            setTimeout(() => {\n                reject(new Error(`Image load timeout: ${src}`));\n            }, 10000);\n            \n            img.src = src;\n        });\n    }\n\n    async handleImageError(img, originalSrc) {\n        const retryKey = originalSrc;\n        const currentRetries = this.retryCount.get(retryKey) || 0;\n\n        if (currentRetries < this.options.retryAttempts) {\n            // Retry loading\n            this.retryCount.set(retryKey, currentRetries + 1);\n            \n            await new Promise(resolve => setTimeout(resolve, this.options.retryDelay));\n            \n            try {\n                await this.preloadImage(originalSrc);\n                img.src = originalSrc;\n                img.removeAttribute('data-src');\n                img.classList.remove('lazy-loading');\n                img.classList.add('lazy-loaded');\n                img.style.opacity = '1';\n                this.removeLoadingIndicator(img);\n                this.loadedImages.add(img);\n                return;\n            } catch (retryError) {\n                console.warn(`Retry ${currentRetries + 1} failed for image:`, originalSrc);\n            }\n        }\n\n        // Final fallback\n        img.src = this.options.errorSrc;\n        img.classList.remove('lazy-loading');\n        img.classList.add('lazy-error');\n        img.style.opacity = '1';\n        this.removeLoadingIndicator(img);\n        this.failedImages.add(img);\n\n        // Trigger error event\n        img.dispatchEvent(new CustomEvent('lazyLoadError', {\n            detail: { originalSrc, img }\n        }));\n    }\n\n    removeLoadingIndicator(img) {\n        const container = img.parentElement;\n        const indicator = container.querySelector('.loading-indicator');\n        if (indicator) {\n            indicator.classList.add('fade-out');\n            setTimeout(() => {\n                if (indicator.parentNode) {\n                    indicator.parentNode.removeChild(indicator);\n                }\n            }, 200);\n        }\n    }\n\n    // Fallback for browsers without Intersection Observer\n    loadAllImages() {\n        const images = document.querySelectorAll('img[data-src]');\n        images.forEach(img => {\n            this.setupImageForLazyLoading(img);\n            this.loadImage(img);\n        });\n    }\n\n    // Refresh observer for dynamically added images\n    refresh() {\n        if (this.observer) {\n            this.observeImages();\n        }\n    }\n\n    // Add new images to be lazy loaded\n    observe(images) {\n        if (!this.observer) return;\n\n        const imgArray = Array.isArray(images) ? images : [images];\n        imgArray.forEach(img => {\n            if (img.tagName === 'IMG' && img.hasAttribute('data-src')) {\n                this.setupImageForLazyLoading(img);\n                this.observer.observe(img);\n            }\n        });\n    }\n\n    // Manually load specific images\n    loadImagesInContainer(container) {\n        const images = container.querySelectorAll('img[data-src]');\n        images.forEach(img => this.loadImage(img));\n    }\n\n    // Get loading statistics\n    getStats() {\n        return {\n            loaded: this.loadedImages.size,\n            failed: this.failedImages.size,\n            pending: document.querySelectorAll('img[data-src]').length\n        };\n    }\n\n    // Destroy the lazy loader\n    destroy() {\n        if (this.observer) {\n            this.observer.disconnect();\n            this.observer = null;\n        }\n        this.loadedImages.clear();\n        this.failedImages.clear();\n        this.retryCount.clear();\n    }\n}\n\n// Create singleton instance\nexport const lazyLoader = new LazyImageLoader();\n\n// Auto-initialize when DOM is ready\nif (typeof window !== 'undefined') {\n    if (document.readyState === 'loading') {\n        document.addEventListener('DOMContentLoaded', () => {\n            lazyLoader.refresh();\n        });\n    } else {\n        lazyLoader.refresh();\n    }\n}","/**\n * Link Health Monitor\n * Monitors and tracks the health of apartment listing URLs\n * Provides fallback mechanisms for dead links\n */\n\nexport class LinkHealthMonitor {\n    constructor() {\n        this.healthCache = new Map();\n        this.maxCacheAge = 5 * 60 * 1000; // 5 minutes\n        this.timeoutDuration = 10000; // 10 seconds\n    }\n\n    /**\n     * Check if a URL is accessible with enhanced error handling\n     * @param {string} url - URL to check\n     * @returns {Promise<{healthy: boolean, status: string, responseTime: number}>}\n     */\n    async checkUrlHealth(url) {\n        // Check cache first\n        const cached = this.getFromCache(url);\n        if (cached) {\n            return cached;\n        }\n\n        const startTime = Date.now();\n        let timeoutId;\n        \n        try {\n            // Enhanced URL validation\n            if (!this.isValidUrl(url)) {\n                throw new Error('Invalid URL format');\n            }\n\n            // Use a timeout to prevent hanging requests\n            const controller = new window.AbortController();\n            timeoutId = setTimeout(() => controller.abort(), this.timeoutDuration);\n\n            // Try multiple methods for better reliability\n            let response;\n            try {\n                // First try HEAD request with no-cors\n                response = await fetch(url, {\n                    method: 'HEAD',\n                    signal: controller.signal,\n                    mode: 'no-cors',\n                    cache: 'no-cache',\n                    redirect: 'follow'\n                });\n            } catch (corsError) {\n                // If HEAD fails, try GET with no-cors as fallback\n                response = await fetch(url, {\n                    method: 'GET',\n                    signal: controller.signal,\n                    mode: 'no-cors',\n                    cache: 'no-cache',\n                    redirect: 'follow'\n                });\n            }\n\n            clearTimeout(timeoutId);\n            const responseTime = Date.now() - startTime;\n\n            // Enhanced status detection\n            let actualStatus = 'accessible';\n            let healthy = true;\n\n            // For no-cors requests, we can't read the actual status\n            // but if no error was thrown, the URL is likely accessible\n            if (response.type === 'opaque') {\n                actualStatus = 'cors_accessible';\n            } else if (response.status) {\n                actualStatus = response.status;\n                healthy = response.status >= 200 && response.status < 400;\n            }\n\n            const result = {\n                healthy,\n                status: actualStatus,\n                responseTime,\n                lastChecked: Date.now(),\n                method: 'validated'\n            };\n\n            this.setCache(url, result);\n            return result;\n\n        } catch (error) {\n            if (timeoutId) clearTimeout(timeoutId);\n            const responseTime = Date.now() - startTime;\n\n            let status = 'unknown';\n            let healthy = false;\n\n            // Enhanced error classification\n            if (error.name === 'AbortError') {\n                status = 'timeout';\n            } else if (error.message.includes('CORS') || error.message.includes('cross-origin')) {  \n                // CORS blocked - URL might still work for users\n                status = 'cors_blocked';\n                healthy = true; // Assume healthy since we can't verify\n            } else if (error.message.includes('NetworkError') || error.message.includes('Failed to fetch')) {\n                // Check if it's a potential domain issue\n                if (this.isKnownGoodDomain(url)) {\n                    status = 'network_cors';\n                    healthy = true; // Known good domain, likely CORS issue\n                } else {\n                    status = 'network_error';\n                }\n            } else if (error.message.includes('404') || error.message.includes('Not Found')) {\n                status = '404_not_found';\n            } else if (error.message.includes('Invalid URL')) {\n                status = 'invalid_url';\n            } else {\n                status = 'error';\n            }\n\n            const result = {\n                healthy,\n                status,\n                responseTime,\n                error: error.message,\n                lastChecked: Date.now(),\n                method: 'error_detected'\n            };\n\n            this.setCache(url, result);\n            return result;\n        }\n    }\n\n    /**\n     * Validate URL format\n     * @param {string} url - URL to validate\n     * @returns {boolean} Whether URL is valid\n     */\n    isValidUrl(url) {\n        try {\n            const urlObj = new URL(url);\n            return urlObj.protocol === 'http:' || urlObj.protocol === 'https:';\n        } catch {\n            return false;\n        }\n    }\n\n    /**\n     * Check if domain is known to be reliable\n     * @param {string} url - URL to check\n     * @returns {boolean} Whether domain is known good\n     */\n    isKnownGoodDomain(url) {\n        const knownGoodDomains = [\n            'apartments.com',\n            'zillow.com',\n            'trulia.com',\n            'hotpads.com',\n            'westsiderentals.com',\n            'realtor.com',\n            'rent.com',\n            'padmapper.com',\n            'craigslist.org',\n            'facebook.com',\n            'google.com'\n        ];\n\n        try {\n            const hostname = new URL(url).hostname.toLowerCase();\n            return knownGoodDomains.some(domain => hostname.includes(domain));\n        } catch {\n            return false;\n        }\n    }\n\n    /**\n     * Check health of multiple URLs\n     * @param {Array<string>} urls - URLs to check\n     * @returns {Promise<Array<{url: string, health: Object}>>}\n     */\n    async checkMultipleUrls(urls) {\n        const checks = urls.map(async (url) => ({\n            url,\n            health: await this.checkUrlHealth(url)\n        }));\n\n        return await Promise.all(checks);\n    }\n\n    /**\n     * Get health status from cache\n     * @param {string} url - URL to lookup\n     * @returns {Object|null} Cached health result or null\n     */\n    getFromCache(url) {\n        const cached = this.healthCache.get(url);\n        if (cached && (Date.now() - cached.lastChecked) < this.maxCacheAge) {\n            return cached;\n        }\n        return null;\n    }\n\n    /**\n     * Store health status in cache\n     * @param {string} url - URL to cache\n     * @param {Object} result - Health check result\n     */\n    setCache(url, result) {\n        this.healthCache.set(url, result);\n        \n        // Clean up old cache entries periodically\n        if (this.healthCache.size > 100) {\n            this.cleanupCache();\n        }\n    }\n\n    /**\n     * Remove old entries from cache\n     */\n    cleanupCache() {\n        const now = Date.now();\n        for (const [url, result] of this.healthCache.entries()) {\n            if ((now - result.lastChecked) > this.maxCacheAge) {\n                this.healthCache.delete(url);\n            }\n        }\n    }\n\n    /**\n     * Get health summary for UI display\n     * @param {Object} healthResult - Result from checkUrlHealth\n     * @returns {Object} UI-friendly health summary\n     */\n    getHealthSummary(healthResult) {\n        const { healthy, status, responseTime, error } = healthResult;\n\n        let summary = {\n            className: 'unknown',\n            icon: 'fas fa-question-circle',\n            message: 'Unknown status',\n            color: '#6c757d'\n        };\n\n        if (healthy) {\n            if (status === 'cors_blocked') {\n                summary = {\n                    className: 'warning',\n                    icon: 'fas fa-exclamation-triangle',\n                    message: 'Cannot verify (CORS), but likely accessible',\n                    color: '#f39c12'\n                };\n            } else {\n                summary = {\n                    className: 'healthy',\n                    icon: 'fas fa-check-circle',\n                    message: `Accessible (${responseTime}ms)`,\n                    color: '#27ae60'\n                };\n            }\n        } else {\n            switch (status) {\n                case 'timeout':\n                    summary = {\n                        className: 'error',\n                        icon: 'fas fa-clock',\n                        message: 'Connection timeout',\n                        color: '#e74c3c'\n                    };\n                    break;\n                case '404_not_found':\n                    summary = {\n                        className: 'error',\n                        icon: 'fas fa-unlink',\n                        message: 'Page not found (404)',\n                        color: '#e74c3c'\n                    };\n                    break;\n                case 'network_error':\n                    summary = {\n                        className: 'error',\n                        icon: 'fas fa-wifi',\n                        message: 'Network error',\n                        color: '#e74c3c'\n                    };\n                    break;\n                default:\n                    summary = {\n                        className: 'error',\n                        icon: 'fas fa-exclamation-circle',\n                        message: error ? `Error: ${error.substring(0, 50)}...` : 'Connection failed',\n                        color: '#e74c3c'\n                    };\n            }\n        }\n\n        return summary;\n    }\n\n    /**\n     * Generate comprehensive alternative search URLs for dead links\n     * @param {string} areaName - Area name (e.g., \"Mar Vista\")\n     * @param {string} zipCode - Zip code (e.g., \"90066\")\n     * @param {number} price - Price range\n     * @returns {Array<{name: string, url: string, priority: number, type: string}>} Alternative URLs\n     */\n    generateAlternativeUrls(areaName, zipCode, price) {\n        const encodedArea = encodeURIComponent(areaName || '');\n        const encodedQuery = encodeURIComponent(`${areaName} CA ${zipCode} apartments rent 2 bedroom`);\n        const priceQuery = price ? encodeURIComponent(`${areaName} apartments under ${price} rent`) : encodedQuery;\n        \n        return [\n            // High-priority alternatives - General searches that always work\n            {\n                name: 'Google Search',\n                url: `https://www.google.com/search?q=${encodedQuery}&tbm=&tbs=qdr:m`,\n                type: 'search',\n                priority: 1,\n                description: 'Comprehensive search results'\n            },\n            {\n                name: 'Apartments.com',\n                url: `https://www.apartments.com/los-angeles-ca/`,\n                type: 'listings',\n                priority: 1,\n                description: 'Browse LA apartments'\n            },\n            {\n                name: 'Zillow Rentals',\n                url: `https://www.zillow.com/los-angeles-ca/rentals/`,\n                type: 'listings',\n                priority: 1,\n                description: 'Rental listings on Zillow'\n            },\n            \n            // Medium-priority alternatives - More specific searches\n            {\n                name: 'Rent.com Search',\n                url: `https://www.rent.com/california/los-angeles-apartments`,\n                type: 'listings',\n                priority: 2,\n                description: 'Rent.com listings'\n            },\n            {\n                name: 'HotPads',\n                url: `https://hotpads.com/los-angeles-ca/apartments-for-rent`,\n                type: 'listings',\n                priority: 2,\n                description: 'Map-based apartment search'\n            },\n            {\n                name: 'Trulia Rentals',\n                url: `https://www.trulia.com/for_rent/Los_Angeles,CA/`,\n                type: 'listings',\n                priority: 2,\n                description: 'Neighborhood-focused search'\n            },\n            \n            // Specialized alternatives\n            {\n                name: 'Westside Rentals',\n                url: `https://www.westsiderentals.com/`,\n                type: 'listings',\n                priority: 2,\n                description: 'Westside LA specialist'\n            },\n            {\n                name: 'PadMapper',\n                url: `https://www.padmapper.com/apartments/los-angeles-ca`,\n                type: 'listings',\n                priority: 3,\n                description: 'Interactive map search'\n            },\n            \n            // Community-based alternatives\n            {\n                name: 'Craigslist LA',\n                url: `https://losangeles.craigslist.org/search/apa?query=${encodedArea}+${zipCode}`,\n                type: 'community',\n                priority: 3,\n                description: 'Community listings'\n            },\n            {\n                name: 'Facebook Marketplace',\n                url: `https://www.facebook.com/marketplace/los-angeles/propertyrentals`,\n                type: 'community',\n                priority: 3,\n                description: 'Social marketplace'\n            },\n            \n            // Backup generic searches\n            {\n                name: 'Bing Search',\n                url: `https://www.bing.com/search?q=${priceQuery}`,\n                type: 'search',\n                priority: 4,\n                description: 'Alternative search engine'\n            },\n            {\n                name: 'Realtor.com',\n                url: `https://www.realtor.com/apartments-for-rent/Los-Angeles_CA`,\n                type: 'listings',\n                priority: 4,\n                description: 'Realtor apartment listings'\n            }\n        ].sort((a, b) => a.priority - b.priority);\n    }\n\n    /**\n     * Generate smart backup URLs based on primary URL failure type\n     * @param {string} primaryUrl - The failed primary URL\n     * @param {string} areaName - Area name\n     * @param {string} zipCode - Zip code  \n     * @param {number} price - Price range\n     * @param {string} failureType - Type of failure detected\n     * @returns {Array} Tailored backup URLs\n     */\n    generateSmartBackups(primaryUrl, areaName, zipCode, price, failureType) {\n        const allAlternatives = this.generateAlternativeUrls(areaName, zipCode, price);\n        \n        // Filter based on failure type\n        switch (failureType) {\n            case 'cors_blocked':\n            case 'network_cors':\n                // CORS issues - prioritize search engines and known-good domains\n                return allAlternatives.filter(alt => \n                    alt.type === 'search' || alt.priority <= 2\n                ).slice(0, 4);\n                \n            case 'timeout':\n                // Timeout issues - prioritize faster, simpler sites\n                return allAlternatives.filter(alt => \n                    alt.priority <= 2 && alt.type !== 'community'\n                ).slice(0, 3);\n                \n            case '404_not_found':\n            case 'invalid_url':\n                // URL structure issues - provide comprehensive alternatives\n                return allAlternatives.slice(0, 6);\n                \n            default:\n                // Generic failure - provide balanced mix\n                return allAlternatives.slice(0, 5);\n        }\n    }\n\n    /**\n     * Monitor apartment URLs and update health status\n     * @param {Array<Object>} apartments - Array of apartment objects\n     * @returns {Promise<Array<Object>>} Apartments with health status\n     */\n    async monitorApartmentUrls(apartments) {\n        // eslint-disable-next-line no-console\n        console.log(` Monitoring health of ${apartments.length} apartment URLs...`);\n        \n        const monitored = [];\n        \n        for (const apartment of apartments) {\n            try {\n                const health = await this.checkUrlHealth(apartment.url);\n                const healthSummary = this.getHealthSummary(health);\n                \n                monitored.push({\n                    ...apartment,\n                    urlHealth: health,\n                    urlHealthSummary: healthSummary,\n                    // Add alternative URLs if main link is unhealthy\n                    alternativeUrls: !health.healthy ? \n                        this.generateAlternativeUrls(apartment.address?.split(',')[1]?.trim(), apartment.zipCode, apartment.price) : \n                        apartment.backupUrls || []\n                });\n                \n                // Add small delay to avoid overwhelming servers\n                await new Promise(resolve => setTimeout(resolve, 100));\n                \n            } catch (error) {\n                // eslint-disable-next-line no-console\n                console.warn(`Failed to monitor URL for apartment ${apartment.id}:`, error);\n                monitored.push({\n                    ...apartment,\n                    urlHealth: { healthy: false, status: 'monitor_error', error: error.message },\n                    urlHealthSummary: {\n                        className: 'error',\n                        icon: 'fas fa-exclamation-circle',\n                        message: 'Monitoring failed',\n                        color: '#e74c3c'\n                    }\n                });\n            }\n        }\n        \n        // eslint-disable-next-line no-console\n        console.log(` URL monitoring complete. ${monitored.filter(a => a.urlHealth?.healthy).length}/${monitored.length} URLs appear healthy.`);\n        \n        return monitored;\n    }\n\n    /**\n     * Clear all cached health data\n     */\n    clearCache() {\n        this.healthCache.clear();\n    }\n\n    /**\n     * Get cache statistics\n     * @returns {Object} Cache statistics\n     */\n    getCacheStats() {\n        const entries = Array.from(this.healthCache.values());\n        \n        return {\n            totalEntries: this.healthCache.size,\n            healthyUrls: entries.filter(e => e.healthy).length,\n            unhealthyUrls: entries.filter(e => !e.healthy).length,\n            averageResponseTime: entries.length > 0 ? \n                entries.reduce((sum, e) => sum + (e.responseTime || 0), 0) / entries.length : 0,\n            oldestEntry: entries.length > 0 ? \n                Math.min(...entries.map(e => e.lastChecked)) : null,\n            newestEntry: entries.length > 0 ? \n                Math.max(...entries.map(e => e.lastChecked)) : null\n        };\n    }\n}\n\n// Export singleton instance\nexport const linkHealthMonitor = new LinkHealthMonitor();","import { ApartmentSearchEngine } from './search-engine.js';\nimport { ApartmentScoring } from './scoring.js';\nimport { lazyLoader } from './lazy-loading.js';\nimport { linkHealthMonitor } from './link-health-monitor.js';\n\nexport class ApartmentFinderApp {\n    constructor() {\n        this.apartments = [];\n        this.filteredApartments = [];\n        this.bookmarkedApartments = JSON.parse(localStorage.getItem('bookmarkedApartments') || '[]');\n        this.isSearching = false;\n        \n        this.init();\n    }\n\n    init() {\n        this.bindEvents();\n        this.loadBookmarks();\n        // eslint-disable-next-line no-console\n        console.log('Apartment Finder App initialized');\n    }\n\n    bindEvents() {\n        // Search button\n        const searchBtn = document.getElementById('searchBtn');\n        searchBtn.addEventListener('click', () => this.startSearch());\n\n        // Filter controls\n        const sortBy = document.getElementById('sortBy');\n        sortBy.addEventListener('change', () => this.applyFilters());\n\n        const minScore = document.getElementById('minScore');\n        minScore.addEventListener('input', (e) => {\n            document.getElementById('minScoreValue').textContent = e.target.value;\n            this.applyFilters();\n        });\n\n        // Filter checkboxes\n        ['recentOnly', 'renovatedOnly', 'premiumOnly'].forEach(id => {\n            document.getElementById(id).addEventListener('change', () => this.applyFilters());\n        });\n\n        // Filter panel toggle\n        const toggleFilters = document.getElementById('toggleFilters');\n        const filterContent = document.querySelector('.filter-content');\n        toggleFilters.addEventListener('click', () => {\n            const isExpanded = filterContent.style.display !== 'none';\n            filterContent.style.display = isExpanded ? 'none' : 'block';\n            toggleFilters.innerHTML = isExpanded ? \n                '<i class=\"fas fa-chevron-down\"></i>' : \n                '<i class=\"fas fa-chevron-up\"></i>';\n        });\n\n        // Modal controls\n        const modal = document.getElementById('apartmentModal');\n        const closeModal = document.getElementById('closeModal');\n        \n        closeModal.addEventListener('click', () => this.closeModal());\n        modal.addEventListener('click', (e) => {\n            if (e.target === modal) this.closeModal();\n        });\n\n        // Export button\n        const exportBtn = document.getElementById('exportBtn');\n        exportBtn.addEventListener('click', () => this.exportResults());\n\n        // Keyboard shortcuts\n        document.addEventListener('keydown', (e) => {\n            if (e.key === 'Escape' && modal.style.display !== 'none') {\n                this.closeModal();\n            }\n            if (e.key === 'Enter' && e.ctrlKey && !this.isSearching) {\n                this.startSearch();\n            }\n        });\n    }\n\n    async startSearch() {\n        if (this.isSearching) return;\n        \n        this.isSearching = true;\n        this.showLoadingState();\n        \n        try {\n            // Initialize search engine and scoring\n            const searchEngine = new ApartmentSearchEngine();\n            const scorer = new ApartmentScoring();\n            \n            // Start search with progress updates\n            const apartments = await searchEngine.searchApartments((progress) => {\n                this.updateProgress(progress);\n            });\n            \n            // Score apartments using the scoring system\n            this.apartments = apartments.map(apt => ({\n                ...apt,\n                score: scorer.calculateScore(apt),\n                scoreBreakdown: scorer.getScoreBreakdown(apt)\n            }));\n            \n            // Monitor URL health for better user experience\n            // eslint-disable-next-line no-console\n            console.log(' Checking apartment listing URLs...');\n            this.apartments = await linkHealthMonitor.monitorApartmentUrls(this.apartments);\n            \n            this.applyFilters();\n            this.showResults();\n            \n        } catch (error) {\n            // eslint-disable-next-line no-console\n            console.error('Search failed:', error);\n            this.showToast('Search failed. Please try again.', 'error');\n        } finally {\n            this.isSearching = false;\n            this.hideLoadingState();\n        }\n    }\n\n    showLoadingState() {\n        const searchBtn = document.getElementById('searchBtn');\n        const loadingIndicator = document.getElementById('loadingIndicator');\n        \n        searchBtn.style.display = 'none';\n        loadingIndicator.style.display = 'block';\n        \n        // Hide results section\n        document.getElementById('resultsSection').style.display = 'none';\n        document.getElementById('filterPanel').style.display = 'none';\n    }\n\n    hideLoadingState() {\n        const searchBtn = document.getElementById('searchBtn');\n        const loadingIndicator = document.getElementById('loadingIndicator');\n        \n        searchBtn.style.display = 'inline-block';\n        loadingIndicator.style.display = 'none';\n    }\n\n    updateProgress(progress) {\n        const steps = ['step1', 'step2', 'step3', 'step4'];\n        const currentStep = Math.min(Math.floor(progress / 25), 3);\n        \n        steps.forEach((stepId, index) => {\n            const element = document.getElementById(stepId);\n            if (index < currentStep) {\n                element.className = 'step completed';\n            } else if (index === currentStep) {\n                element.className = 'step active';\n            } else {\n                element.className = 'step';\n            }\n        });\n    }\n\n    applyFilters() {\n        if (!this.apartments.length) return;\n\n        let filtered = [...this.apartments];\n        \n        // Apply score filter\n        const minScore = parseInt(document.getElementById('minScore').value);\n        filtered = filtered.filter(apt => apt.score >= minScore);\n        \n        // Apply checkbox filters\n        if (document.getElementById('recentOnly').checked) {\n            const weekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);\n            filtered = filtered.filter(apt => new Date(apt.datePosted) > weekAgo);\n        }\n        \n        if (document.getElementById('renovatedOnly').checked) {\n            filtered = filtered.filter(apt => apt.recentlyRenovated);\n        }\n        \n        if (document.getElementById('premiumOnly').checked) {\n            filtered = filtered.filter(apt => apt.premiumAmenities);\n        }\n        \n        // Apply sorting\n        const sortBy = document.getElementById('sortBy').value;\n        filtered.sort((a, b) => {\n            switch (sortBy) {\n                case 'score': return b.score - a.score;\n                case 'price-low': return a.price - b.price;\n                case 'price-high': return b.price - a.price;\n                case 'newest': return new Date(b.datePosted) - new Date(a.datePosted);\n                default: return b.score - a.score;\n            }\n        });\n        \n        this.filteredApartments = filtered;\n        this.renderResults();\n    }\n\n    showResults() {\n        document.getElementById('resultsSection').style.display = 'block';\n        document.getElementById('filterPanel').style.display = 'block';\n        \n        // Scroll to results\n        document.getElementById('resultsSection').scrollIntoView({ \n            behavior: 'smooth' \n        });\n    }\n\n    renderResults() {\n        const resultsGrid = document.getElementById('resultsGrid');\n        const recentResults = document.getElementById('recentResults');\n        const recentListings = document.getElementById('recentListings');\n        const noResults = document.getElementById('noResults');\n        const resultsCount = document.getElementById('resultsCount');\n        \n        // Update results count\n        resultsCount.textContent = `${this.filteredApartments.length} apartments found`;\n        \n        if (this.filteredApartments.length === 0) {\n            resultsGrid.innerHTML = '';\n            recentResults.innerHTML = '';\n            recentListings.style.display = 'none';\n            noResults.style.display = 'block';\n            return;\n        }\n        \n        noResults.style.display = 'none';\n        \n        // Separate recent listings (past week)\n        const weekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);\n        const recentApartments = this.filteredApartments.filter(apt => \n            new Date(apt.datePosted) > weekAgo\n        );\n        const allApartments = this.filteredApartments;\n        \n        // Render recent listings\n        if (recentApartments.length > 0) {\n            recentListings.style.display = 'block';\n            recentResults.innerHTML = recentApartments\n                .slice(0, 6)\n                .map(apt => this.createApartmentCard(apt, true))\n                .join('');\n        } else {\n            recentListings.style.display = 'none';\n        }\n        \n        // Render all results\n        resultsGrid.innerHTML = allApartments\n            .map(apt => this.createApartmentCard(apt))\n            .join('');\n        \n        // Add click events to apartment cards\n        document.querySelectorAll('.apartment-card').forEach(card => {\n            card.addEventListener('click', () => {\n                const apartmentId = card.dataset.apartmentId;\n                const apartment = this.apartments.find(apt => apt.id === apartmentId);\n                this.showApartmentDetails(apartment);\n            });\n        });\n\n        // Add backup link toggle functionality\n        document.querySelectorAll('.show-backups-btn').forEach(button => {\n            button.addEventListener('click', (e) => {\n                e.stopPropagation();\n                const backupLinks = button.parentElement.querySelector('.backup-links');\n                const chevron = button.querySelector('i');\n                \n                if (backupLinks) {\n                    const isVisible = backupLinks.style.display !== 'none';\n                    backupLinks.style.display = isVisible ? 'none' : 'block';\n                    \n                    // Update button text and icon\n                    const buttonText = button.childNodes[1]; // Text node after icon\n                    if (isVisible) {\n                        buttonText.textContent = ' More Options';\n                        chevron.className = 'fas fa-chevron-down';\n                        button.classList.remove('expanded');\n                    } else {\n                        buttonText.textContent = ' Hide Alternatives';\n                        chevron.className = 'fas fa-chevron-up';\n                        button.classList.add('expanded');\n                    }\n                }\n            });\n        });\n\n        // Initialize lazy loading for new images\n        setTimeout(() => {\n            lazyLoader.refresh();\n        }, 100);\n    }\n\n    createApartmentCard(apartment) {\n        const scoreClass = apartment.score >= 80 ? 'high' : \n                          apartment.score >= 60 ? 'medium' : 'low';\n        \n        const features = apartment.features.slice(0, 3).map(feature => \n            `<span class=\"feature-tag ${apartment.highlightFeatures?.includes(feature) ? 'highlight' : ''}\">${feature}</span>`\n        ).join('');\n        \n        const bookmarked = this.bookmarkedApartments.includes(apartment.id);\n        \n        return `\n            <div class=\"apartment-card fade-in\" data-apartment-id=\"${apartment.id}\">\n                <div class=\"card-image\">\n                    <div class=\"image-container\">\n                        ${apartment.images && apartment.images.length > 0 ? \n                            `<img class=\"property-image\" data-src=\"${apartment.images[0]}\" alt=\"${apartment.title}\" onerror=\"this.classList.add('lazy-error')\">` :\n                            '<div class=\"no-image-placeholder\"><i class=\"fas fa-image\"></i><span>No Image Available</span></div>'\n                        }\n                    </div>\n                    <div class=\"score-badge ${scoreClass}\">${apartment.score}</div>\n                    ${bookmarked ? '<div class=\"bookmark-indicator\"><i class=\"fas fa-bookmark\"></i></div>' : ''}\n                </div>\n                <div class=\"card-content\">\n                    <h3 class=\"card-title\">${apartment.title}</h3>\n                    <p class=\"card-address\">\n                        <i class=\"fas fa-map-marker-alt\"></i>\n                        ${apartment.address}\n                    </p>\n                    \n                    <div class=\"card-details\">\n                        <div class=\"detail-item\">\n                            <i class=\"fas fa-bed\"></i>\n                            ${apartment.bedrooms} bed\n                        </div>\n                        <div class=\"detail-item\">\n                            <i class=\"fas fa-bath\"></i>\n                            ${apartment.bathrooms} bath\n                        </div>\n                        <div class=\"detail-item\">\n                            <i class=\"fas fa-ruler-combined\"></i>\n                            ${apartment.sqft || 'N/A'} sq ft\n                        </div>\n                        <div class=\"detail-item\">\n                            <i class=\"fas fa-building\"></i>\n                            Floor ${apartment.floor || 'N/A'}\n                        </div>\n                    </div>\n                    \n                    <div class=\"card-features\">\n                        ${features}\n                        ${apartment.features.length > 3 ? \n                            `<span class=\"feature-tag\">+${apartment.features.length - 3} more</span>` : \n                            ''\n                        }\n                    </div>\n                    \n                    <div class=\"card-price\">$${apartment.price.toLocaleString()}/month</div>\n                    \n                    <div class=\"card-actions\">\n                        <div class=\"listing-buttons\">\n                            ${this.renderPrimaryListingButton(apartment)}\n                            ${this.renderBackupOptions(apartment)}\n                        </div>\n                        <div class=\"listing-info\">\n                            <span class=\"listing-source\">Primary source: ${apartment.source}</span>\n                            ${apartment.urlHealthSummary ? `\n                                <div class=\"link-health-indicator ${apartment.urlHealthSummary.className}\">\n                                    <i class=\"${apartment.urlHealthSummary.icon}\"></i>\n                                    <span class=\"health-tooltip\">${apartment.urlHealthSummary.message}</span>\n                                </div>\n                            ` : ''}\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n\n    renderPrimaryListingButton(apartment) {\n        const healthStatus = apartment.urlHealth;\n        const isHealthy = !healthStatus || healthStatus.healthy;\n        \n        let buttonClass = 'view-listing-btn primary';\n        let buttonText = `View on ${apartment.source}`;\n        let icon = 'fas fa-external-link-alt';\n        \n        if (healthStatus && !healthStatus.healthy) {\n            buttonClass += ' warning';\n            buttonText = `Try ${apartment.source}`;\n            icon = 'fas fa-exclamation-triangle';\n        }\n        \n        return `\n            <a href=\"${apartment.url}\" target=\"_blank\" rel=\"noopener noreferrer\" \n               class=\"${buttonClass}\" onclick=\"event.stopPropagation();\"\n               title=\"${healthStatus ? healthStatus.status : 'Link status unknown'}\">\n                <i class=\"${icon}\"></i>\n                ${buttonText}\n            </a>\n        `;\n    }\n\n    renderBackupOptions(apartment) {\n        const backupUrls = apartment.backupUrls || apartment.alternativeUrls || [];\n        \n        if (backupUrls.length === 0) {\n            return '';\n        }\n\n        const priorityBackups = backupUrls.filter(backup => backup.priority <= 2).slice(0, 3);\n        const additionalBackups = backupUrls.filter(backup => backup.priority > 2);\n\n        let backupHtml = '';\n        \n        // Always show top priority backups if primary link is unhealthy\n        const showBackupsByDefault = apartment.urlHealth && !apartment.urlHealth.healthy;\n        \n        if (priorityBackups.length > 0) {\n            backupHtml += `\n                <div class=\"backup-links\" style=\"display: ${showBackupsByDefault ? 'block' : 'none'};\">\n                    ${priorityBackups.map(backup => `\n                        <a href=\"${backup.url}\" target=\"_blank\" rel=\"noopener noreferrer\" \n                           class=\"view-listing-btn backup ${backup.type === 'search' ? 'search' : 'listing'}\" \n                           onclick=\"event.stopPropagation();\"\n                           title=\"${backup.description || backup.name}\">\n                            <i class=\"fas fa-${backup.type === 'search' ? 'search' : 'building'}\"></i>\n                            ${backup.name}\n                        </a>\n                    `).join('')}\n                </div>\n            `;\n        }\n\n        // Show toggle button for additional options\n        if (priorityBackups.length > 0 || additionalBackups.length > 0) {\n            const buttonText = showBackupsByDefault ? 'Hide Alternatives' : 'More Options';\n            const chevronDirection = showBackupsByDefault ? 'up' : 'down';\n            \n            backupHtml += `\n                <button class=\"show-backups-btn ${showBackupsByDefault ? 'expanded' : ''}\" \n                        onclick=\"event.stopPropagation(); this.toggleBackupLinks();\">\n                    <i class=\"fas fa-chevron-${chevronDirection}\"></i>\n                    ${buttonText}\n                </button>\n            `;\n        }\n\n        return backupHtml;\n    }\n\n    showApartmentDetails(apartment) {\n        const modal = document.getElementById('apartmentModal');\n        const modalTitle = document.getElementById('modalTitle');\n        const modalBody = document.getElementById('modalBody');\n        const bookmarkBtn = document.getElementById('bookmarkBtn');\n        \n        modalTitle.textContent = apartment.title;\n        \n        const scoreClass = apartment.score >= 80 ? 'high' : \n                          apartment.score >= 60 ? 'medium' : 'low';\n        \n        const imageGallery = apartment.images && apartment.images.length > 0 ? \n            `<div class=\"image-gallery\">\n                ${apartment.images.map((img, index) => \n                    `<div class=\"image-container\" style=\"margin-bottom: 1rem;\">\n                        <img class=\"property-image\" \n                             ${index === 0 ? `src=\"${img}\"` : `data-src=\"${img}\"`} \n                             alt=\"Apartment image\" \n                             style=\"width: 100%; border-radius: 8px;\"\n                             onerror=\"this.classList.add('lazy-error')\">\n                    </div>`\n                ).join('')}\n            </div>` : \n            '<div class=\"no-image\">No images available</div>';\n        \n        modalBody.innerHTML = `\n            ${imageGallery}\n            \n            <div class=\"apartment-details\">\n                <div class=\"detail-header\">\n                    <div class=\"score-display\">\n                        <span class=\"score-badge ${scoreClass}\">${apartment.score}</span>\n                        <span class=\"score-label\">Match Score</span>\n                    </div>\n                    <div class=\"price-display\">\n                        <span class=\"price\">$${apartment.price.toLocaleString()}</span>\n                        <span class=\"price-label\">per month</span>\n                    </div>\n                </div>\n                \n                <div class=\"address-section\">\n                    <h4><i class=\"fas fa-map-marker-alt\"></i> Address</h4>\n                    <p>${apartment.address}</p>\n                    <p><strong>Zip Code:</strong> ${apartment.zipCode}</p>\n                </div>\n                \n                <div class=\"specs-section\">\n                    <h4><i class=\"fas fa-info-circle\"></i> Specifications</h4>\n                    <div class=\"specs-grid\">\n                        <div class=\"spec-item\">\n                            <i class=\"fas fa-bed\"></i>\n                            <span>${apartment.bedrooms} Bedrooms</span>\n                        </div>\n                        <div class=\"spec-item\">\n                            <i class=\"fas fa-bath\"></i>\n                            <span>${apartment.bathrooms} Bathrooms</span>\n                        </div>\n                        <div class=\"spec-item\">\n                            <i class=\"fas fa-ruler-combined\"></i>\n                            <span>${apartment.sqft || 'N/A'} sq ft</span>\n                        </div>\n                        <div class=\"spec-item\">\n                            <i class=\"fas fa-building\"></i>\n                            <span>Floor ${apartment.floor || 'N/A'}</span>\n                        </div>\n                    </div>\n                </div>\n                \n                <div class=\"amenities-section\">\n                    <h4><i class=\"fas fa-star\"></i> Amenities & Features</h4>\n                    <div class=\"amenities-grid\">\n                        ${apartment.features.map(feature => \n                            `<div class=\"amenity-item ${apartment.highlightFeatures?.includes(feature) ? 'highlight' : ''}\">\n                                <i class=\"fas fa-check\"></i>\n                                ${feature}\n                            </div>`\n                        ).join('')}\n                    </div>\n                </div>\n                \n                ${apartment.description ? `\n                    <div class=\"description-section\">\n                        <h4><i class=\"fas fa-file-text\"></i> Description</h4>\n                        <p>${apartment.description}</p>\n                    </div>\n                ` : ''}\n                \n                <div class=\"listing-url-section\">\n                    <h4><i class=\"fas fa-external-link-alt\"></i> View Full Listing</h4>\n                    <div class=\"url-container\">\n                        ${this.renderModalPrimaryButton(apartment)}\n                        ${this.renderModalHealthStatus(apartment)}\n                        ${this.renderModalBackupOptions(apartment)}\n                    </div>\n                </div>\n                \n                <div class=\"contact-section\">\n                    <h4><i class=\"fas fa-phone\"></i> Contact Information</h4>\n                    <p><strong>Phone:</strong> ${apartment.contact?.phone || 'Not available'}</p>\n                    <p><strong>Email:</strong> ${apartment.contact?.email || 'Not available'}</p>\n                    <p><strong>Source:</strong> ${apartment.source}</p>\n                    <p><strong>Posted:</strong> ${new Date(apartment.datePosted).toLocaleDateString()}</p>\n                </div>\n            </div>\n        `;\n        \n        // Update bookmark button\n        const isBookmarked = this.bookmarkedApartments.includes(apartment.id);\n        bookmarkBtn.innerHTML = isBookmarked ? \n            '<i class=\"fas fa-bookmark\"></i> Bookmarked' : \n            '<i class=\"far fa-bookmark\"></i> Bookmark';\n        \n        bookmarkBtn.onclick = () => this.toggleBookmark(apartment.id);\n        \n        // Show modal\n        modal.style.display = 'flex';\n        setTimeout(() => {\n            modal.classList.add('show');\n            // Initialize lazy loading for modal images\n            lazyLoader.refresh();\n        }, 10);\n    }\n\n    closeModal() {\n        const modal = document.getElementById('apartmentModal');\n        modal.classList.remove('show');\n        setTimeout(() => modal.style.display = 'none', 300);\n    }\n\n    toggleBookmark(apartmentId) {\n        const index = this.bookmarkedApartments.indexOf(apartmentId);\n        if (index > -1) {\n            this.bookmarkedApartments.splice(index, 1);\n            this.showToast('Bookmark removed', 'warning');\n        } else {\n            this.bookmarkedApartments.push(apartmentId);\n            this.showToast('Apartment bookmarked!', 'success');\n        }\n        \n        localStorage.setItem('bookmarkedApartments', JSON.stringify(this.bookmarkedApartments));\n        this.renderResults(); // Re-render to update bookmark indicators\n        \n        // Update bookmark button in modal\n        const bookmarkBtn = document.getElementById('bookmarkBtn');\n        const isBookmarked = this.bookmarkedApartments.includes(apartmentId);\n        bookmarkBtn.innerHTML = isBookmarked ? \n            '<i class=\"fas fa-bookmark\"></i> Bookmarked' : \n            '<i class=\"far fa-bookmark\"></i> Bookmark';\n    }\n\n    loadBookmarks() {\n        // eslint-disable-next-line no-console\n        console.log(`Loaded ${this.bookmarkedApartments.length} bookmarked apartments`);\n    }\n\n    exportResults() {\n        if (this.filteredApartments.length === 0) {\n            this.showToast('No results to export', 'warning');\n            return;\n        }\n        \n        const exportData = this.filteredApartments.map(apt => ({\n            title: apt.title,\n            address: apt.address,\n            price: apt.price,\n            bedrooms: apt.bedrooms,\n            bathrooms: apt.bathrooms,\n            sqft: apt.sqft,\n            score: apt.score,\n            features: apt.features.join(', '),\n            contact: apt.contact?.phone || '',\n            source: apt.source,\n            datePosted: apt.datePosted\n        }));\n        \n        const csv = this.convertToCSV(exportData);\n        this.downloadCSV(csv, 'apartment-search-results.csv');\n        this.showToast('Results exported successfully!', 'success');\n    }\n\n    convertToCSV(data) {\n        const headers = Object.keys(data[0]).join(',');\n        const rows = data.map(row => \n            Object.values(row).map(value => \n                typeof value === 'string' && value.includes(',') ? \n                    `\"${value}\"` : value\n            ).join(',')\n        );\n        return [headers, ...rows].join('\\n');\n    }\n\n    downloadCSV(csv, filename) {\n        const blob = new Blob([csv], { type: 'text/csv' });\n        const url = window.URL.createObjectURL(blob);\n        const a = document.createElement('a');\n        a.setAttribute('hidden', '');\n        a.setAttribute('href', url);\n        a.setAttribute('download', filename);\n        document.body.appendChild(a);\n        a.click();\n        document.body.removeChild(a);\n        window.URL.revokeObjectURL(url);\n    }\n\n    showToast(message, type = 'success') {\n        const container = document.getElementById('toastContainer');\n        const toast = document.createElement('div');\n        toast.className = `toast ${type}`;\n        toast.innerHTML = `\n            <div class=\"toast-content\">\n                <i class=\"fas fa-${type === 'success' ? 'check-circle' : \n                                 type === 'error' ? 'exclamation-circle' : \n                                 'exclamation-triangle'}\"></i>\n                <span>${message}</span>\n            </div>\n        `;\n        \n        container.appendChild(toast);\n        setTimeout(() => toast.classList.add('show'), 100);\n        \n        setTimeout(() => {\n            toast.classList.remove('show');\n            setTimeout(() => container.removeChild(toast), 300);\n        }, 4000);\n    }\n\n    renderModalPrimaryButton(apartment) {\n        const healthStatus = apartment.urlHealth;\n        const isHealthy = !healthStatus || healthStatus.healthy;\n        \n        let buttonClass = 'modal-view-listing-btn primary';\n        let buttonText = `View on ${apartment.source}`;\n        let icon = 'fas fa-external-link-alt';\n        \n        if (healthStatus && !healthStatus.healthy) {\n            buttonClass += ' warning';\n            buttonText = `Try ${apartment.source} (may not work)`;\n            icon = 'fas fa-exclamation-triangle';\n        }\n        \n        return `\n            <a href=\"${apartment.url}\" target=\"_blank\" rel=\"noopener noreferrer\" class=\"${buttonClass}\">\n                <i class=\"${icon}\"></i>\n                ${buttonText}\n            </a>\n        `;\n    }\n\n    renderModalHealthStatus(apartment) {\n        const healthStatus = apartment.urlHealth;\n        const healthSummary = apartment.urlHealthSummary;\n        \n        if (!healthStatus || !healthSummary) {\n            return '<p class=\"url-disclaimer\">Primary listing from ' + apartment.source + '. Link status unknown.</p>';\n        }\n\n        let statusHtml = '';\n        \n        if (healthStatus.healthy) {\n            if (healthStatus.status === 'cors_accessible' || healthStatus.status === 'cors_blocked') {\n                statusHtml = `\n                    <div class=\"health-status warning\">\n                        <i class=\"fas fa-info-circle\"></i>\n                        <span>Link appears to work but cannot be fully verified due to browser security restrictions.</span>\n                    </div>\n                `;\n            } else {\n                statusHtml = `\n                    <div class=\"health-status healthy\">\n                        <i class=\"fas fa-check-circle\"></i>\n                        <span>Link verified and accessible (response: ${healthStatus.responseTime}ms)</span>\n                    </div>\n                `;\n            }\n        } else {\n            statusHtml = `\n                <div class=\"health-status error\">\n                    <i class=\"fas fa-exclamation-triangle\"></i>\n                    <span>Primary link may not work: ${healthSummary.message}. Try alternatives below.</span>\n                </div>\n            `;\n        }\n\n        return statusHtml + `<p class=\"url-disclaimer\">Primary listing from ${apartment.source}.</p>`;\n    }\n\n    renderModalBackupOptions(apartment) {\n        const backupUrls = apartment.backupUrls || apartment.alternativeUrls || [];\n        \n        if (backupUrls.length === 0) {\n            return '';\n        }\n\n        const priorityBackups = backupUrls.filter(backup => backup.priority <= 2);\n        const additionalBackups = backupUrls.filter(backup => backup.priority > 2);\n        const showPriorityByDefault = apartment.urlHealth && !apartment.urlHealth.healthy;\n\n        let backupHtml = `\n            <div class=\"backup-options\">\n                <h5><i class=\"fas fa-life-ring\"></i> Alternative Search Options</h5>\n        `;\n\n        if (apartment.urlHealth && !apartment.urlHealth.healthy) {\n            backupHtml += '<p class=\"backup-info urgent\"> Primary link issue detected. These alternatives are recommended:</p>';\n        } else {\n            backupHtml += '<p class=\"backup-info\">If the primary link doesn\\'t work, try these alternatives:</p>';\n        }\n\n        // Priority backups (always show if primary is unhealthy)\n        if (priorityBackups.length > 0) {\n            backupHtml += `\n                <div class=\"backup-buttons priority\">\n                    <h6>Recommended Alternatives:</h6>\n                    ${priorityBackups.map(backup => `\n                        <a href=\"${backup.url}\" target=\"_blank\" rel=\"noopener noreferrer\" \n                           class=\"modal-view-listing-btn backup ${backup.type === 'search' ? 'search' : 'listing'}\"\n                           title=\"${backup.description || backup.name}\">\n                            <i class=\"fas fa-${backup.type === 'search' ? 'search' : 'building'}\"></i>\n                            ${backup.name}\n                            ${backup.description ? `<small>${backup.description}</small>` : ''}\n                        </a>\n                    `).join('')}\n                </div>\n            `;\n        }\n\n        // Additional backups (collapsible)\n        if (additionalBackups.length > 0) {\n            backupHtml += `\n                <div class=\"additional-backups\">\n                    <button class=\"expand-more-backups\" onclick=\"this.toggleAdditionalBackups();\">\n                        <i class=\"fas fa-chevron-down\"></i>\n                        Show More Options (${additionalBackups.length})\n                    </button>\n                    <div class=\"backup-buttons additional\" style=\"display: none;\">\n                        ${additionalBackups.map(backup => `\n                            <a href=\"${backup.url}\" target=\"_blank\" rel=\"noopener noreferrer\" \n                               class=\"modal-view-listing-btn backup ${backup.type}\"\n                               title=\"${backup.description || backup.name}\">\n                                <i class=\"fas fa-${backup.type === 'search' ? 'search' : 'building'}\"></i>\n                                ${backup.name}\n                            </a>\n                        `).join('')}\n                    </div>\n                </div>\n            `;\n        }\n\n        backupHtml += '</div>';\n        return backupHtml;\n    }\n}\n\n// Initialize app when DOM is loaded\nif (typeof window !== 'undefined') {\n    document.addEventListener('DOMContentLoaded', () => {\n        new ApartmentFinderApp();\n    });\n}","export class ClaudeIntegration {\n    constructor() {\n        this.apiKey = null; // Will be set by user in settings\n        this.baseURL = 'https://api.anthropic.com/v1/messages';\n        this.model = 'claude-3-sonnet-20240229';\n        this.maxTokens = 1000;\n        \n        this.init();\n    }\n\n    init() {\n        // Check for stored API key\n        this.apiKey = localStorage.getItem('claude_api_key');\n        \n        // Create settings panel if API key is not set\n        if (!this.apiKey) {\n            this.showAPIKeySetup();\n        }\n    }\n\n    showAPIKeySetup() {\n        const existingSetup = document.getElementById('apiKeySetup');\n        if (existingSetup) return;\n\n        const setupPanel = document.createElement('div');\n        setupPanel.id = 'apiKeySetup';\n        setupPanel.className = 'api-key-setup';\n        setupPanel.innerHTML = `\n            <div class=\"setup-content\">\n                <h3><i class=\"fas fa-key\"></i> API Configuration</h3>\n                <p>To enable Claude AI enhanced search features, please enter your Anthropic API key:</p>\n                <div class=\"input-group\">\n                    <input type=\"password\" id=\"apiKeyInput\" placeholder=\"sk-ant-api...\" />\n                    <button id=\"saveApiKey\" class=\"btn-primary\">Save</button>\n                </div>\n                <div class=\"setup-info\">\n                    <p><small>\n                        <i class=\"fas fa-info-circle\"></i>\n                        Your API key is stored locally and never shared. \n                        <a href=\"https://console.anthropic.com/\" target=\"_blank\">Get your API key here</a>\n                    </small></p>\n                </div>\n                <button id=\"skipApiKey\" class=\"btn-secondary\">Skip (Use Mock Data)</button>\n            </div>\n        `;\n\n        document.body.appendChild(setupPanel);\n\n        // Bind events\n        document.getElementById('saveApiKey').addEventListener('click', () => {\n            const apiKey = document.getElementById('apiKeyInput').value.trim();\n            if (apiKey) {\n                this.setAPIKey(apiKey);\n                setupPanel.remove();\n            }\n        });\n\n        document.getElementById('skipApiKey').addEventListener('click', () => {\n            setupPanel.remove();\n        });\n\n        document.getElementById('apiKeyInput').addEventListener('keypress', (e) => {\n            if (e.key === 'Enter') {\n                document.getElementById('saveApiKey').click();\n            }\n        });\n    }\n\n    setAPIKey(apiKey) {\n        this.apiKey = apiKey;\n        localStorage.setItem('claude_api_key', apiKey);\n        console.log('Claude API key configured');\n    }\n\n    async enhanceApartmentDescriptions(apartments) {\n        if (!this.apiKey || apartments.length === 0) {\n            return apartments; // Return as-is if no API key or no apartments\n        }\n\n        try {\n            const prompt = this.buildDescriptionEnhancementPrompt(apartments);\n            const response = await this.callClaudeAPI(prompt);\n            \n            if (response && response.enhanced_descriptions) {\n                return this.applyEnhancedDescriptions(apartments, response.enhanced_descriptions);\n            }\n        } catch (error) {\n            console.error('Error enhancing descriptions:', error);\n        }\n\n        return apartments;\n    }\n\n    async generateSearchInsights(apartments) {\n        if (!this.apiKey || apartments.length === 0) {\n            return null;\n        }\n\n        try {\n            const prompt = this.buildInsightsPrompt(apartments);\n            const response = await this.callClaudeAPI(prompt);\n            \n            return response;\n        } catch (error) {\n            console.error('Error generating insights:', error);\n            return null;\n        }\n    }\n\n    buildDescriptionEnhancementPrompt(apartments) {\n        const apartmentSummaries = apartments.slice(0, 10).map((apt, index) => ({\n            id: index,\n            title: apt.title,\n            address: apt.address,\n            price: apt.price,\n            features: apt.features.slice(0, 6),\n            score: apt.score\n        }));\n\n        return `\nYou are a real estate expert helping to enhance apartment descriptions for a luxury apartment search in West Los Angeles. \n\nHere are ${apartmentSummaries.length} apartments that match the search criteria:\n\n${JSON.stringify(apartmentSummaries, null, 2)}\n\nPlease provide enhanced descriptions for these apartments that:\n1. Highlight the most appealing features\n2. Use professional real estate language\n3. Emphasize luxury and comfort aspects\n4. Keep descriptions concise (2-3 sentences)\n5. Focus on what makes each apartment unique\n\nRespond in JSON format:\n{\n  \"enhanced_descriptions\": [\n    {\n      \"id\": 0,\n      \"enhanced_description\": \"Enhanced description here...\"\n    }\n  ]\n}\n        `;\n    }\n\n    buildInsightsPrompt(apartments) {\n        const topApartments = apartments.slice(0, 5);\n        const avgPrice = apartments.reduce((sum, apt) => sum + apt.price, 0) / apartments.length;\n        const scoreDistribution = {\n            high: apartments.filter(apt => apt.score >= 80).length,\n            medium: apartments.filter(apt => apt.score >= 60 && apt.score < 80).length,\n            low: apartments.filter(apt => apt.score < 60).length\n        };\n\n        return `\nYou are a real estate market analyst. Analyze this apartment search data for West Los Angeles and provide insights.\n\nSearch Results Summary:\n- Total apartments found: ${apartments.length}\n- Average price: $${Math.round(avgPrice)}\n- Score distribution: ${scoreDistribution.high} high-scoring, ${scoreDistribution.medium} medium-scoring, ${scoreDistribution.low} low-scoring\n\nTop 5 apartments:\n${JSON.stringify(topApartments.map(apt => ({\n    title: apt.title,\n    address: apt.address,\n    price: apt.price,\n    score: apt.score,\n    zipCode: apt.zipCode\n})), null, 2)}\n\nPlease provide:\n1. Market insights about pricing trends\n2. Best value recommendations\n3. Areas to focus on for better options\n4. Red flags to watch for\n5. Negotiation opportunities\n\nRespond in JSON format with actionable insights.\n        `;\n    }\n\n    async callClaudeAPI(prompt) {\n        if (!this.apiKey) {\n            throw new Error('API key not configured');\n        }\n\n        const response = await fetch(this.baseURL, {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n                'x-api-key': this.apiKey,\n                'anthropic-version': '2023-06-01'\n            },\n            body: JSON.stringify({\n                model: this.model,\n                max_tokens: this.maxTokens,\n                messages: [{\n                    role: 'user',\n                    content: prompt\n                }]\n            })\n        });\n\n        if (!response.ok) {\n            throw new Error(`API call failed: ${response.status} ${response.statusText}`);\n        }\n\n        const data = await response.json();\n        \n        try {\n            return JSON.parse(data.content[0].text);\n        } catch (parseError) {\n            console.error('Error parsing Claude response:', parseError);\n            return { error: 'Failed to parse response' };\n        }\n    }\n\n    applyEnhancedDescriptions(apartments, enhancedDescriptions) {\n        const enhancedMap = new Map();\n        enhancedDescriptions.forEach(item => {\n            enhancedMap.set(item.id, item.enhanced_description);\n        });\n\n        return apartments.map((apartment, index) => {\n            if (index < 10 && enhancedMap.has(index)) {\n                return {\n                    ...apartment,\n                    description: enhancedMap.get(index),\n                    enhanced: true\n                };\n            }\n            return apartment;\n        });\n    }\n\n    // Smart filtering using Claude AI\n    async intelligentFilter(apartments, userQuery) {\n        if (!this.apiKey || !userQuery.trim()) {\n            return apartments;\n        }\n\n        try {\n            const prompt = `\nYou are helping filter apartment listings based on user preferences. \n\nUser query: \"${userQuery}\"\n\nAvailable apartments (showing first 20):\n${JSON.stringify(apartments.slice(0, 20).map(apt => ({\n    id: apt.id,\n    title: apt.title,\n    address: apt.address,\n    price: apt.price,\n    features: apt.features,\n    score: apt.score\n})), null, 2)}\n\nBased on the user query, rank these apartments and explain why each is relevant or not relevant.\nFocus on matching user intent, not just keywords.\n\nRespond in JSON format:\n{\n  \"filtered_apartments\": [\n    {\n      \"id\": \"apartment_id\",\n      \"relevance_score\": 85,\n      \"reason\": \"Why this apartment matches the query\"\n    }\n  ]\n}\n            `;\n\n            const response = await this.callClaudeAPI(prompt);\n            \n            if (response && response.filtered_apartments) {\n                return this.applyIntelligentFiltering(apartments, response.filtered_apartments);\n            }\n        } catch (error) {\n            console.error('Error in intelligent filtering:', error);\n        }\n\n        return apartments;\n    }\n\n    applyIntelligentFiltering(apartments, filteredResults) {\n        const relevanceMap = new Map();\n        filteredResults.forEach(result => {\n            relevanceMap.set(result.id, {\n                relevance: result.relevance_score,\n                reason: result.reason\n            });\n        });\n\n        return apartments\n            .map(apartment => {\n                const relevanceData = relevanceMap.get(apartment.id);\n                if (relevanceData) {\n                    return {\n                        ...apartment,\n                        aiRelevance: relevanceData.relevance,\n                        aiReason: relevanceData.reason\n                    };\n                }\n                return apartment;\n            })\n            .filter(apartment => apartment.aiRelevance !== undefined)\n            .sort((a, b) => (b.aiRelevance || 0) - (a.aiRelevance || 0));\n    }\n\n    // Generate personalized recommendations\n    async generateRecommendations(apartments, userPreferences = {}) {\n        if (!this.apiKey) {\n            return this.generateMockRecommendations(apartments);\n        }\n\n        try {\n            const prompt = `\nAs a real estate expert, provide personalized apartment recommendations based on user preferences and available listings.\n\nUser Preferences:\n${JSON.stringify(userPreferences, null, 2)}\n\nAvailable Apartments (top 10 by score):\n${JSON.stringify(apartments.slice(0, 10).map(apt => ({\n    title: apt.title,\n    address: apt.address,\n    price: apt.price,\n    features: apt.features,\n    score: apt.score,\n    zipCode: apt.zipCode\n})), null, 2)}\n\nProvide:\n1. Top 3 recommendations with detailed reasoning\n2. Alternative options to consider\n3. What to negotiate on\n4. Potential concerns to investigate\n\nRespond in JSON format with actionable recommendations.\n            `;\n\n            const response = await this.callClaudeAPI(prompt);\n            return response;\n        } catch (error) {\n            console.error('Error generating recommendations:', error);\n            return this.generateMockRecommendations(apartments);\n        }\n    }\n\n    generateMockRecommendations(apartments) {\n        const topApartments = apartments.slice(0, 3);\n        \n        return {\n            recommendations: topApartments.map((apt, index) => ({\n                apartment_id: apt.id,\n                ranking: index + 1,\n                reason: `High score of ${apt.score} with excellent ${apt.features.slice(0, 2).join(' and ')}`,\n                strengths: apt.features.slice(0, 3),\n                concerns: ['Verify parking availability', 'Check actual condition']\n            })),\n            market_insights: {\n                avg_price: Math.round(apartments.reduce((sum, apt) => sum + apt.price, 0) / apartments.length),\n                best_value: apartments.find(apt => apt.score > 70 && apt.price < 4700)?.id || null,\n                negotiation_tip: 'Focus on move-in incentives rather than base rent'\n            }\n        };\n    }\n\n    // Utility method to check API status\n    async testAPIConnection() {\n        if (!this.apiKey) {\n            return { success: false, error: 'No API key configured' };\n        }\n\n        try {\n            const response = await this.callClaudeAPI('Test connection. Respond with: {\"status\": \"connected\"}');\n            return { success: true, response };\n        } catch (error) {\n            return { success: false, error: error.message };\n        }\n    }\n}\n\n// Export for use in other modules\nexport const claudeAI = new ClaudeIntegration();"],"names":["ApartmentSearchEngine","constructor","this","searchCriteria","minRent","maxRent","bedrooms","minBathrooms","maxBathrooms","zipCodes","zipCodePriority","requiredAmenities","preferredFeatures","dataSources","name","priority","active","searchApartments","progressCallback","allApartments","totalSteps","length","i","zipCode","apartments","searchZipCode","push","delay","error","console","concat","validApartments","filter","validateApartment","apt","removeDuplicates","log","generateMockApartments","apartmentCount","Math","floor","random","areaData","areaName","basePrice","priceVariance","neighborhoods","streetNames","buildingTypes","amenityPool","buildingNumber","streetName","buildingType","priceOffset","price","round","finalPrice","max","min","selectedAmenities","selectRandomAmenities","sqft","bathrooms","renovationChance","recentlyRenovated","daysAgo","datePosted","Date","now","apartment","id","title","address","features","highlightFeatures","getHighlightFeatures","premiumAmenities","includes","toISOString","source","getRandomSource","url","generateListingUrl","backupUrls","generateBackupUrls","contact","phone","generatePhoneNumber","email","toLowerCase","replace","images","generateMockImages","description","generateDescription","score","pool","count","sort","slice","highlights","highlightMap","forEach","feature","sources","areaCode","exchange","number","stableSources","baseUrl","template","_building","area","zip","_price","weight","totalWeight","reduce","sum","selectedSource","urlPath","finalUrl","isValidUrl","Error","warn","urlObj","URL","protocol","e","sanitizeCityName","cityName","imageCount","amenities","descriptions","baseDescription","amenityText","join","seen","Set","key","has","add","ms","Promise","resolve","setTimeout","validateUrl","controller","AbortController","timeoutId","abort","response","fetch","method","signal","mode","clearTimeout","valid","status","warning","generateValidatedListingUrl","encodedQuery","encodeURIComponent","type","criteria","map","f","hasWasherDryer","some","hasAC","hasOutdoor","aboveGround","ApartmentScoring","weights","rentInRange","mandatoryAmenities","renovationRecency","naturalLight","outdoorSpaceQuality","locationRating","professionalPhotos","floorLevel","maxScore","calculateScore","totalScore","calculateRentScore","calculateMandatoryAmenityScore","calculateRenovationScore","calculateNaturalLightScore","calculateOutdoorSpaceScore","calculateZipCodeScore","calculatePremiumAmenitiesScore","calculateLocationRatingScore","calculatePhotoScore","calculateFloorScore","getScoreBreakdown","breakdown","specs","renovation","total","optimalRent","maxDeviation","deviation","abs","washerDryer","airConditioning","outdoorSpace","aboveGroundFloor","completionRate","Object","values","Boolean","keys","renovationKeywords","hasRenovationKeywords","keyword","explicitlyRenovated","modernAmenities","hasModernAmenities","amenity","_a","lightKeywords","lightIndicators","text","floorBonus","outdoorSpaceTypes","terrace","deck","balcony","patio","outdoor","spaceType","multiplier","entries","scoreMultiplier","premiumCount","baseRating","priceBonus","finalRating","lazyLoader","options","rootMargin","threshold","placeholderSrc","errorSrc","fadeInDuration","retryAttempts","retryDelay","observer","loadedImages","failedImages","retryCount","Map","init","window","IntersectionObserver","entry","isIntersecting","loadImage","target","observeImages","loadAllImages","document","querySelectorAll","img","setupImageForLazyLoading","observe","src","classList","addLoadingIndicator","style","opacity","transition","container","parentElement","contains","wrapper","createElement","className","parentNode","insertBefore","appendChild","querySelector","indicator","innerHTML","getAttribute","unobserve","preloadImage","removeAttribute","remove","removeLoadingIndicator","dispatchEvent","CustomEvent","detail","handleImageError","reject","Image","onload","onerror","originalSrc","retryKey","currentRetries","get","set","retryError","removeChild","refresh","Array","isArray","tagName","hasAttribute","loadImagesInContainer","getStats","loaded","size","failed","pending","destroy","disconnect","clear","readyState","addEventListener","linkHealthMonitor","healthCache","maxCacheAge","timeoutDuration","checkUrlHealth","cached","getFromCache","startTime","cache","redirect","corsError","responseTime","actualStatus","healthy","result","lastChecked","setCache","message","isKnownGoodDomain","knownGoodDomains","hostname","domain","checkMultipleUrls","urls","checks","async","health","all","cleanupCache","delete","getHealthSummary","healthResult","summary","icon","color","substring","generateAlternativeUrls","encodedArea","priceQuery","a","b","generateSmartBackups","primaryUrl","failureType","allAlternatives","alt","monitorApartmentUrls","monitored","healthSummary","urlHealth","urlHealthSummary","alternativeUrls","_b","split","trim","clearCache","getCacheStats","from","totalEntries","healthyUrls","unhealthyUrls","averageResponseTime","oldestEntry","newestEntry","ApartmentFinderApp","filteredApartments","bookmarkedApartments","JSON","parse","localStorage","getItem","isSearching","bindEvents","loadBookmarks","getElementById","startSearch","applyFilters","textContent","value","toggleFilters","filterContent","isExpanded","display","modal","closeModal","exportResults","ctrlKey","showLoadingState","searchEngine","scorer","progress","updateProgress","scoreBreakdown","showResults","showToast","hideLoadingState","searchBtn","loadingIndicator","currentStep","stepId","index","element","filtered","minScore","parseInt","checked","weekAgo","sortBy","renderResults","scrollIntoView","behavior","resultsGrid","recentResults","recentListings","noResults","recentApartments","createApartmentCard","card","apartmentId","dataset","find","showApartmentDetails","button","stopPropagation","backupLinks","chevron","isVisible","buttonText","childNodes","scoreClass","bookmarked","toLocaleString","renderPrimaryListingButton","renderBackupOptions","healthStatus","buttonClass","priorityBackups","backup","additionalBackups","backupHtml","showBackupsByDefault","chevronDirection","modalTitle","modalBody","bookmarkBtn","imageGallery","renderModalPrimaryButton","renderModalHealthStatus","renderModalBackupOptions","toLocaleDateString","isBookmarked","onclick","toggleBookmark","indexOf","splice","setItem","stringify","exportData","csv","convertToCSV","downloadCSV","data","row","filename","blob","Blob","createObjectURL","setAttribute","body","click","revokeObjectURL","toast","statusHtml","apiKey","baseURL","model","maxTokens","showAPIKeySetup","setupPanel","setAPIKey","enhanceApartmentDescriptions","prompt","buildDescriptionEnhancementPrompt","callClaudeAPI","enhanced_descriptions","applyEnhancedDescriptions","generateSearchInsights","buildInsightsPrompt","apartmentSummaries","topApartments","avgPrice","scoreDistribution","high","medium","low","headers","max_tokens","messages","role","content","ok","statusText","json","parseError","enhancedDescriptions","enhancedMap","item","enhanced_description","enhanced","intelligentFilter","userQuery","filtered_apartments","applyIntelligentFiltering","filteredResults","relevanceMap","relevance","relevance_score","reason","relevanceData","aiRelevance","aiReason","generateRecommendations","userPreferences","generateMockRecommendations","recommendations","apartment_id","ranking","strengths","concerns","market_insights","avg_price","best_value","negotiation_tip","testAPIConnection","success"],"mappings":"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"}